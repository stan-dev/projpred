<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extend a family — extend_family • projpred</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extend a family — extend_family"><meta name="description" content="This function adds some internally required elements to an object of class
family (see, e.g., family()). It is called internally by
init_refmodel(), so you will rarely need to call it yourself."><meta property="og:description" content="This function adds some internally required elements to an object of class
family (see, e.g., family()). It is called internally by
init_refmodel(), so you will rarely need to call it yourself."><meta property="og:image" content="https://mc-stan.org/projpred/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      projpred
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/projpred/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Extend a family</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/master/R/extend_family.R" class="external-link"><code>R/extend_family.R</code></a></small>
      <div class="d-none name"><code>extend_family.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function adds some internally required elements to an object of class
<code>family</code> (see, e.g., <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code>). It is called internally by
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>, so you will rarely need to call it yourself.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extend_family</span><span class="op">(</span></span>
<span>  <span class="va">family</span>,</span>
<span>  latent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  latent_y_unqs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  latent_ilink <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  latent_ll_oscale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  latent_ppd_oscale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augdat_y_unqs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augdat_link <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augdat_ilink <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augdat_args_link <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  augdat_args_ilink <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>An object of class <code>family</code>.</p></dd>


<dt id="arg-latent">latent<a class="anchor" aria-label="anchor" href="#arg-latent"></a></dt>
<dd><p>A single logical value indicating whether to use the latent
projection (<code>TRUE</code>) or not (<code>FALSE</code>). Note that setting <code>latent = TRUE</code>
causes all arguments starting with <code>augdat_</code> to be ignored.</p></dd>


<dt id="arg-latent-y-unqs">latent_y_unqs<a class="anchor" aria-label="anchor" href="#arg-latent-y-unqs"></a></dt>
<dd><p>Only relevant for a latent projection where the original
response space has finite support (i.e., the original response values may
be regarded as categories), in which case this needs to be the character
vector of unique response values (which will be assigned to <code>family$cats</code>
internally) or may be left at <code>NULL</code> (so that <span class="pkg">projpred</span> will try to
infer it from <code>family$cats</code>). See also section "Latent projection" below.</p></dd>


<dt id="arg-latent-ilink">latent_ilink<a class="anchor" aria-label="anchor" href="#arg-latent-ilink"></a></dt>
<dd><p>Only relevant for the latent projection, in which case
this needs to be the inverse-link function. If the original response family
was the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> or the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> family, then <code>latent_ilink</code> can be
<code>NULL</code>, in which case an internal default will be used. Can also be <code>NULL</code>
in all other cases, but then an internal default based on <code>family$linkinv</code>
will be used which might not work for all families. See also section
"Latent projection" below.</p></dd>


<dt id="arg-latent-ll-oscale">latent_ll_oscale<a class="anchor" aria-label="anchor" href="#arg-latent-ll-oscale"></a></dt>
<dd><p>Only relevant for the latent projection, in which
case this needs to be the function computing response-scale (not
latent-scale) log-likelihood values. If <code>!is.null(family$cats)</code> (after
taking <code>latent_y_unqs</code> into account) or if the original response family was
the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> or the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> family, then <code>latent_ll_oscale</code> can be
<code>NULL</code>, in which case an internal default will be used. Can also be <code>NULL</code>
in all other cases, but then downstream functions will have limited
functionality (a message thrown by <code>extend_family()</code> will state what
exactly won't be available). See also section "Latent projection" below.</p></dd>


<dt id="arg-latent-ppd-oscale">latent_ppd_oscale<a class="anchor" aria-label="anchor" href="#arg-latent-ppd-oscale"></a></dt>
<dd><p>Only relevant for the latent projection, in which
case this needs to be the function sampling response values given latent
predictors that have been transformed to response scale using
<code>latent_ilink</code>. If <code>!is.null(family$cats)</code> (after taking <code>latent_y_unqs</code>
into account) or if the original response family was the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> or
the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> family, then <code>latent_ppd_oscale</code> can be <code>NULL</code>, in which
case an internal default will be used. Can also be <code>NULL</code> in all other
cases, but then downstream functions will have limited functionality (a
message thrown by <code>extend_family()</code> will state what exactly won't be
available). See also section "Latent projection" below. Note that although
this function has the abbreviation "PPD" in its name (which stands for
"posterior predictive distribution"), <span class="pkg">projpred</span> currently only uses it
in <code><a href="pred-projection.html">proj_predict()</a></code>, i.e., for sampling from what would better be termed
posterior-projection predictive distribution (PPPD).</p></dd>


<dt id="arg-augdat-y-unqs">augdat_y_unqs<a class="anchor" aria-label="anchor" href="#arg-augdat-y-unqs"></a></dt>
<dd><p>Only relevant for augmented-data projection, in which
case this needs to be the character vector of unique response values (which
will be assigned to <code>family$cats</code> internally) or may be left at <code>NULL</code> if
<code>family$cats</code> is already non-<code>NULL</code>. See also section "Augmented-data
projection" below.</p></dd>


<dt id="arg-augdat-link">augdat_link<a class="anchor" aria-label="anchor" href="#arg-augdat-link"></a></dt>
<dd><p>Only relevant for augmented-data projection, in which case
this needs to be the link function. Use <code>NULL</code> for the traditional
projection. See also section "Augmented-data projection" below.</p></dd>


<dt id="arg-augdat-ilink">augdat_ilink<a class="anchor" aria-label="anchor" href="#arg-augdat-ilink"></a></dt>
<dd><p>Only relevant for augmented-data projection, in which
case this needs to be the inverse-link function. Use <code>NULL</code> for the
traditional projection. See also section "Augmented-data projection" below.</p></dd>


<dt id="arg-augdat-args-link">augdat_args_link<a class="anchor" aria-label="anchor" href="#arg-augdat-args-link"></a></dt>
<dd><p>Only relevant for augmented-data projection, in which
case this may be a named <code>list</code> of arguments to pass to the function
supplied to <code>augdat_link</code>.</p></dd>


<dt id="arg-augdat-args-ilink">augdat_args_ilink<a class="anchor" aria-label="anchor" href="#arg-augdat-args-ilink"></a></dt>
<dd><p>Only relevant for augmented-data projection, in
which case this may be a named <code>list</code> of arguments to pass to the function
supplied to <code>augdat_ilink</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Ignored (exists only to swallow up further arguments which might
be passed to this function).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The <code>family</code> object extended in the way needed by <span class="pkg">projpred</span>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In the following, \(N\), \(C_{\mathrm{cat}}\),
\(C_{\mathrm{lat}}\), \(S_{\mathrm{ref}}\), and
\(S_{\mathrm{prj}}\) from help topic <a href="refmodel-init-get.html">refmodel-init-get</a> are used.
Note that \(N\) does not necessarily denote the number of original
observations; it can also refer to new observations. Furthermore, let \(S\)
denote either \(S_{\mathrm{ref}}\) or \(S_{\mathrm{prj}}\),
whichever is appropriate in the context where it is used.</p>
    </div>
    <div class="section level2">
    <h2 id="augmented-data-projection">Augmented-data projection<a class="anchor" aria-label="anchor" href="#augmented-data-projection"></a></h2>
    <p>As their first input, the functions supplied to arguments <code>augdat_link</code> and
<code>augdat_ilink</code> have to accept:</p><ul><li><p>For <code>augdat_link</code>: an \(S \times N \times C_{\mathrm{cat}}\) array containing the probabilities for the response categories. The
order of the response categories is the same as in <code>family$cats</code> (see
argument <code>augdat_y_unqs</code>).</p></li>
<li><p>For <code>augdat_ilink</code>: an \(S \times N \times C_{\mathrm{lat}}\) array containing the linear predictors.</p></li>
</ul><p>The return value of these functions needs to be:</p><ul><li><p>For <code>augdat_link</code>: an \(S \times N \times C_{\mathrm{lat}}\) array containing the linear predictors.</p></li>
<li><p>For <code>augdat_ilink</code>: an \(S \times N \times C_{\mathrm{cat}}\) array containing the probabilities for the response categories. The
order of the response categories has to be the same as in <code>family$cats</code> (see
argument <code>augdat_y_unqs</code>).</p></li>
</ul><p>For the augmented-data projection, the response vector resulting from
<code>extract_model_data</code> (see <code><a href="refmodel-init-get.html">init_refmodel()</a></code>) is coerced to a <code>factor</code> (using
<code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>) at multiple places throughout this package. Inside of
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>, the levels of this <code>factor</code> have to be identical to
<code>family$cats</code> (<em>after</em> applying <code>extend_family()</code> inside of
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>). Everywhere else, these levels have to be a subset of
<code>&lt;refmodel&gt;$family$cats</code> (where <code>&lt;refmodel&gt;</code> is an object resulting from
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>). See argument <code>augdat_y_unqs</code> for how to control
<code>family$cats</code>.</p>
<p>For ordinal <span class="pkg">brms</span> families, be aware that the submodels (onto which the
reference model is projected) currently have the following restrictions:</p><ul><li><p>The discrimination parameter <code>disc</code> is not supported (i.e., it is a
constant with value 1).</p></li>
<li><p>The thresholds are <code>"flexible"</code> (see <code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">brms::brmsfamily()</a></code>).</p></li>
<li><p>The thresholds do not vary across the levels of a <code>factor</code>-like variable
(see argument <code>gr</code> of <code><a href="https://paulbuerkner.com/brms/reference/addition-terms.html" class="external-link">brms::resp_thres()</a></code>).</p></li>
<li><p>The <code>"probit_approx"</code> link is replaced by <code>"probit"</code>.</p></li>
</ul><p>For the <code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">brms::categorical()</a></code> family, be aware that:</p><ul><li><p>For multilevel submodels, the group-level effects are allowed to be
correlated between different response categories.</p></li>
<li><p>For multilevel submodels, <span class="pkg">mclogit</span> versions &lt; 0.9.4 may throw the
error <code>'a' (&lt;number&gt; x 1) must be square</code>. Updating <span class="pkg">mclogit</span> to a
version &gt;= 0.9.4 should fix this.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="latent-projection">Latent projection<a class="anchor" aria-label="anchor" href="#latent-projection"></a></h2>
    <p>The function supplied to argument <code>latent_ilink</code> needs to have the prototype</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">latent_ilink</span><span class="op">(</span><span class="va">lpreds</span>, <span class="va">cl_ref</span>, wdraws_ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl_ref</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>where:</p><ul><li><p><code>lpreds</code> accepts an \(S \times N\) matrix containing the linear
predictors.</p></li>
<li><p><code>cl_ref</code> accepts a numeric vector of length \(S_{\mathrm{ref}}\),
containing <span class="pkg">projpred</span>'s internal cluster indices for these draws.</p></li>
<li><p><code>wdraws_ref</code> accepts a numeric vector of length
\(S_{\mathrm{ref}}\), containing weights for these draws. These
weights should be treated as not being normalized (i.e., they don't
necessarily sum to <code>1</code>).</p></li>
</ul><p>The return value of <code>latent_ilink</code> needs to contain the linear predictors
transformed to the original response space, with the following structure:</p><ul><li><p>If <code>is.null(family$cats)</code> (after taking <code>latent_y_unqs</code> into account): an
\(S \times N\) matrix.</p></li>
<li><p>If <code>!is.null(family$cats)</code> (after taking <code>latent_y_unqs</code> into account): an
\(S \times N \times C_{\mathrm{cat}}\) array. In that case,
<code>latent_ilink</code> needs to return <em>probabilities</em> (for the response categories
given in <code>family$cats</code>, after taking <code>latent_y_unqs</code> into account).</p></li>
</ul><p>The function supplied to argument <code>latent_ll_oscale</code> needs to have the
prototype</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">latent_ll_oscale</span><span class="op">(</span><span class="va">ilpreds</span>, <span class="va">dis</span>, <span class="va">y_oscale</span>, wobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ilpreds</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 <span class="va">cens</span>, <span class="va">cl_ref</span>, wdraws_ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl_ref</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>where:</p><ul><li><p><code>ilpreds</code> accepts the return value from <code>latent_ilink</code>.</p></li>
<li><p><code>dis</code> accepts a vector of length \(S\) containing dispersion parameter
draws.</p></li>
<li><p><code>y_oscale</code> accepts a vector of length \(N\) containing response values on
the original response scale.</p></li>
<li><p><code>wobs</code> accepts a numeric vector of length \(N\) containing observation
weights.</p></li>
<li><p><code>cens</code> accepts a vector containing censoring indicators for the
observations for which to calculate the response-scale log-likelihood values
(i.e., for the observations from the second dimension of <code>ilpreds</code>). When
calling <code>latent_ll_oscale</code>, <span class="pkg">projpred</span> always specifies argument <code>cens</code>
(with value <code>NULL</code> if attribute <code>cens_var</code> of <code>latent_ll_oscale</code> does not
exist or is <code>NULL</code>), so a default value of <code>cens</code> can be defined, but will
not be used.</p></li>
<li><p><code>cl_ref</code> accepts the same input as argument <code>cl_ref</code> of <code>latent_ilink</code>.</p></li>
<li><p><code>wdraws_ref</code> accepts the same input as argument <code>wdraws_ref</code> of
<code>latent_ilink</code>.</p></li>
</ul><p>In case of censoring (in the response values, i.e., survival or time-to-event
analysis), the latent projection (with response-scale analyses) can be used
by setting an attribute <code>cens_var</code> of the <code>latent_ll_oscale</code> function to a
right-hand side formula with the name of the variable containing the
censoring indicators (e.g., <code>0</code> = uncensored, <code>1</code> = censored) on its
right-hand side. This variable named in the <code>cens_var</code> attribute is then
retrieved (internally, whenever calling the <code>latent_ll_oscale</code> function) from
the original dataset (possibly subsetted to the observations corresponding to
the second dimension of <code>ilpreds</code>), <code>newdata</code>, or element <code>data</code> from
<code><a href="varsel.html">varsel()</a></code>'s argument <code>d_test</code>, whichever is applicable. The content of the
retrieved variable is passed to argument <code>cens</code> of the <code>latent_ll_oscale</code>
function. Note that only the performance statistics <code>"elpd"</code>, <code>"mlpd"</code>, and
<code>"gmpd"</code> take censoring into account (on response scale).</p>
<p>The return value of <code>latent_ll_oscale</code> needs to be an \(S \times N\)
matrix containing the response-scale (not latent-scale) log-likelihood values
for the \(N\) observations from its inputs.</p>
<p>The function supplied to argument <code>latent_ppd_oscale</code> needs to have the
prototype</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">latent_ppd_oscale</span><span class="op">(</span><span class="va">ilpreds_resamp</span>, <span class="va">dis_resamp</span>,</span>
<span>                  wobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ilpreds_resamp</span><span class="op">)</span><span class="op">)</span>, <span class="va">cl_ref</span>,</span>
<span>                  wdraws_ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl_ref</span><span class="op">)</span><span class="op">)</span>, <span class="va">idxs_prjdraws</span><span class="op">)</span></span></code></pre><p></p></div>
<p>where:</p><ul><li><p><code>ilpreds_resamp</code> accepts the return value from <code>latent_ilink</code>, but possibly
with resampled (clustered) draws (see argument <code>nresample_clusters</code> of
<code><a href="pred-projection.html">proj_predict()</a></code>).</p></li>
<li><p><code>dis_resamp</code> accepts a vector of length <code>dim(ilpreds_resamp)[1]</code> containing
dispersion parameter draws, possibly resampled (in the same way as the draws
in <code>ilpreds_resamp</code>, see also argument <code>idxs_prjdraws</code>).</p></li>
<li><p><code>wobs</code> accepts a numeric vector of length \(N\) containing observation
weights.</p></li>
<li><p><code>cl_ref</code> accepts the same input as argument <code>cl_ref</code> of <code>latent_ilink</code>.</p></li>
<li><p><code>wdraws_ref</code> accepts the same input as argument <code>wdraws_ref</code> of
<code>latent_ilink</code>.</p></li>
<li><p><code>idxs_prjdraws</code> accepts a numeric vector of length <code>dim(ilpreds_resamp)[1]</code>
containing the resampled indices of the projected draws (i.e., these indices
are values from the set \(\{1, ..., \texttt{dim(ilpreds)[1]}\}\) where <code>ilpreds</code> denotes the return value of
<code>latent_ilink</code>).</p></li>
</ul><p>The return value of <code>latent_ppd_oscale</code> needs to be a
\(\texttt{dim(ilpreds\_resamp)[1]} \times N\)
matrix containing the response-scale (not latent-scale) draws from the
posterior(-projection) predictive distributions for the \(N\) observations
from its inputs.</p>
<p>If the bodies of these three functions involve parameter draws from the
reference model which have not been projected (e.g., for <code>latent_ilink</code>, the
thresholds in an ordinal model), <code><a href="cl_agg.html">cl_agg()</a></code> is provided as a helper function
for aggregating these reference model draws in the same way as the draws have
been aggregated for the first argument of these functions (e.g., <code>lpreds</code> in
case of <code>latent_ilink</code>).</p>
<p>In fact, the weights passed to argument <code>wdraws_ref</code> are nonconstant only in
case of <code><a href="cv_varsel.html">cv_varsel()</a></code> with <code>cv_method = "LOO"</code> and <code>validate_search = TRUE</code>.
In that case, the weights passed to this argument are the PSIS-LOO CV weights
for one observation. Note that although argument <code>wdraws_ref</code> has the suffix
<code>_ref</code>, <code>wdraws_ref</code> does not necessarily obtain weights for the <em>initial</em>
reference model's posterior draws: In case of <code><a href="cv_varsel.html">cv_varsel()</a></code> with <code>cv_method = "kfold"</code>, these weights may refer to one of the \(K\) reference model
refits (but in that case, they are constant anyway).</p>
<p>If <code>family$cats</code> is not <code>NULL</code> (after taking <code>latent_y_unqs</code> into account),
then the response vector resulting from <code>extract_model_data</code> (see
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>) is coerced to a <code>factor</code> (using <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>) at multiple
places throughout this package. Inside of <code><a href="refmodel-init-get.html">init_refmodel()</a></code>, the levels of
this <code>factor</code> have to be identical to <code>family$cats</code> (<em>after</em> applying
<code>extend_family()</code> inside of <code><a href="refmodel-init-get.html">init_refmodel()</a></code>). Everywhere else, these levels
have to be a subset of <code>&lt;refmodel&gt;$family$cats</code> (where <code>&lt;refmodel&gt;</code> is an
object resulting from <code><a href="refmodel-init-get.html">init_refmodel()</a></code>).</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Osvaldo Martin, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

