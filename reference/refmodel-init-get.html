<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Reference model and more general information — refmodel-init-get • projpred</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Reference model and more general information — refmodel-init-get"><meta property="og:description" content='Function get_refmodel() is a generic function whose methods usually call
init_refmodel() which is the underlying workhorse (and may also be used
directly without a call to get_refmodel()).
Both, get_refmodel() and init_refmodel(), create an object containing
information needed for the projection predictive variable selection, namely
about the reference model, the submodels, and how the projection should be
carried out. For the sake of simplicity, the documentation may refer to the
resulting object also as "reference model" or "reference model object", even
though it also contains information about the submodels and the projection.
A "typical" reference model object is created by get_refmodel.stanreg() and
brms::get_refmodel.brmsfit(), either implicitly by a call to a top-level
function such as project(), varsel(), and cv_varsel() or explicitly by
a call to get_refmodel(). All non-"typical" reference model objects will be
called "custom" reference model objects.
Some arguments are for \(K\)-fold cross-validation (\(K\)-fold CV) only;
see cv_varsel() for the use of \(K\)-fold CV in projpred.'><meta property="og:image" content="https://mc-stan.org/projpred/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">projpred</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr" class="external-link">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior" class="external-link">posterior</a>
    </li>
  </ul></li>
<li>
  <a href="https://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/projpred/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Reference model and more general information</h1>
    <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/HEAD/R/refmodel.R" class="external-link"><code>R/refmodel.R</code></a></small>
    <div class="hidden name"><code>refmodel-init-get.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function <code>get_refmodel()</code> is a generic function whose methods usually call
<code>init_refmodel()</code> which is the underlying workhorse (and may also be used
directly without a call to <code>get_refmodel()</code>).</p>
<p>Both, <code>get_refmodel()</code> and <code>init_refmodel()</code>, create an object containing
information needed for the projection predictive variable selection, namely
about the reference model, the submodels, and how the projection should be
carried out. For the sake of simplicity, the documentation may refer to the
resulting object also as "reference model" or "reference model object", even
though it also contains information about the submodels and the projection.</p>
<p>A "typical" reference model object is created by <code>get_refmodel.stanreg()</code> and
<code><a href="https://rdrr.io/pkg/brms/man/get_refmodel.brmsfit.html" class="external-link">brms::get_refmodel.brmsfit()</a></code>, either implicitly by a call to a top-level
function such as <code><a href="project.html">project()</a></code>, <code><a href="varsel.html">varsel()</a></code>, and <code><a href="cv_varsel.html">cv_varsel()</a></code> or explicitly by
a call to <code>get_refmodel()</code>. All non-"typical" reference model objects will be
called "custom" reference model objects.</p>
<p>Some arguments are for \(K\)-fold cross-validation (\(K\)-fold CV) only;
see <code><a href="cv_varsel.html">cv_varsel()</a></code> for the use of \(K\)-fold CV in <span class="pkg">projpred</span>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for refmodel</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for vsel</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">formula</span>, family <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for stanreg</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">init_refmodel</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  ref_predfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  div_minimizer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  proj_predfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">extract_model_data</span>,</span>
<span>  cvfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cvfits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dis <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cvrefbuilder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>For <code>init_refmodel()</code>, an object that the functions from
arguments <code>extract_model_data</code> and <code>ref_predfun</code> can be applied to, with a
<code>NULL</code> object being treated specially (see section "Value" below). For
<code>get_refmodel.default()</code>, an object of type <code>list</code> that (i) function
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code> can be applied to in order to retrieve the family (if argument
<code>family</code> is <code>NULL</code>) and (ii) has an element called <code>data</code> containing the
original dataset (see argument <code>data</code> of <code>init_refmodel()</code>), additionally
to the properties required for <code>init_refmodel()</code>. For non-default methods
of <code>get_refmodel()</code>, an object of the corresponding class.</p></dd>


<dt>...</dt>
<dd><p>For <code>get_refmodel.default()</code> and <code>get_refmodel.stanreg()</code>:
arguments passed to <code>init_refmodel()</code>. For the <code>get_refmodel()</code> generic:
arguments passed to the appropriate method. Else: ignored.</p></dd>


<dt>formula</dt>
<dd><p>The full formula to use for the search procedure. For custom
reference models, this does not necessarily coincide with the reference
model's formula. For general information on formulas in <span style="R">R</span>, see
<code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>. For multilevel formulas, see also package <span class="pkg">lme4</span> (in
particular, functions <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> and <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">lme4::glmer()</a></code>). For additive
formulas, see also packages <span class="pkg">mgcv</span> (in particular, function
<code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code>) and <span class="pkg">gamm4</span> (in particular, function <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4::gamm4()</a></code>)
as well as the notes in section "Formula terms" below.</p></dd>


<dt>family</dt>
<dd><p>An object of class <code>family</code> representing the observation model
(i.e., the distributional family for the response) of the <em>submodels</em>.
(However, the link and the inverse-link function of this <code>family</code> are also
used for quantities like predictions and fitted values related to the
<em>reference model</em>.) May be <code>NULL</code> for <code>get_refmodel.default()</code> in which
case the family is retrieved from <code>object</code>. For custom reference models,
<code>family</code> does not have to coincide with the family of the reference model
(if the reference model possesses a formal <code>family</code> at all). In typical
reference models, however, these families do coincide.</p></dd>


<dt>data</dt>
<dd><p>A <code>data.frame</code> containing the data to use for the projection
predictive variable selection. Any <code>contrasts</code> attributes of the dataset's
columns are silently removed. For custom reference models, the columns of
<code>data</code> do not necessarily have to coincide with those of the dataset used
for fitting the reference model, but keep in mind that a row-subset of
<code>data</code> is used for argument <code>newdata</code> of <code>ref_predfun</code> during \(K\)-fold
CV.</p></dd>


<dt>ref_predfun</dt>
<dd><p>Prediction function for the linear predictor of the
reference model, including offsets (if existing). See also section
"Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>" below. If
<code>object</code> is <code>NULL</code>, <code>ref_predfun</code> is ignored and an internal default is
used instead.</p></dd>


<dt>div_minimizer</dt>
<dd><p>A function for minimizing the Kullback-Leibler (KL)
divergence from the reference model to a submodel (i.e., for performing the
projection of the reference model onto a submodel). The output of
<code>div_minimizer</code> is used, e.g., by <code>proj_predfun</code>'s argument <code>fits</code>. See
also section "Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>"
below.</p></dd>


<dt>proj_predfun</dt>
<dd><p>Prediction function for the linear predictor of a
submodel onto which the reference model is projected. See also section
"Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>" below.</p></dd>


<dt>extract_model_data</dt>
<dd><p>A function for fetching some variables (response,
observation weights, offsets) from the original dataset (supplied to
argument <code>data</code>) or from a new dataset. See also section "Argument
<code>extract_model_data</code>" below.</p></dd>


<dt>cvfun</dt>
<dd><p>For \(K\)-fold CV only. A function that, given a fold indices
vector, fits the reference model separately for each fold and returns the
\(K\) model fits as a <code>list</code>. Each of the \(K\) model fits needs to be
a <code>list</code>. If <code>object</code> is <code>NULL</code>, <code>cvfun</code> may be <code>NULL</code> for using an
internal default. Only one of <code>cvfits</code> and <code>cvfun</code> needs to be provided
(for \(K\)-fold CV). Note that <code>cvfits</code> takes precedence over <code>cvfun</code>,
i.e., if both are provided, <code>cvfits</code> is used.</p></dd>


<dt>cvfits</dt>
<dd><p>For \(K\)-fold CV only. A <code>list</code> containing a sub-<code>list</code>
called <code>fits</code> containing the \(K\) model fits from which reference model
structures are created. The <code>cvfits</code> <code>list</code> (i.e., the super-<code>list</code>) needs
to have attributes <code>K</code> and <code>folds</code>: <code>K</code> has to be a single integer giving
the number of folds and <code>folds</code> has to be an integer vector giving the fold
indices (one fold index per observation). Each element of <code>cvfits$fits</code>
(i.e., each of the \(K\) model fits) needs to be a list. Only one of
<code>cvfits</code> and <code>cvfun</code> needs to be provided (for \(K\)-fold CV). Note that
<code>cvfits</code> takes precedence over <code>cvfun</code>, i.e., if both are provided,
<code>cvfits</code> is used.</p></dd>


<dt>dis</dt>
<dd><p>A vector of posterior draws for the reference model's dispersion
parameter or---more precisely---the posterior values for the reference
model's parameter-conditional predictive variance (assuming that this
variance is the same for all observations). May be <code>NULL</code> if the submodels
have no dispersion parameter or if the submodels do have a dispersion
parameter, but <code>object</code> is <code>NULL</code> (in which case <code>0</code> is used for <code>dis</code>).
Note that for the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code> <code>family</code>, <code>dis</code> is the standard deviation,
not the variance.</p></dd>


<dt>cvrefbuilder</dt>
<dd><p>For \(K\)-fold CV only. A function that, given a
reference model fit for fold \(k \in \{1, ..., K\}\) (this
model fit is the \(k\)-th element of the return value of <code>cvfun</code> or the
\(k\)-th element of <code>cvfits$fits</code>, extended by elements <code>omitted</code>
(containing the indices of the left-out observations in that fold) and
<code>projpred_k</code> (containing the integer \(k\))), returns an object of the
same type as <code>init_refmodel()</code> does. Argument <code>cvrefbuilder</code> may be <code>NULL</code>
for using an internal default: <code>get_refmodel()</code> if <code>object</code> is not <code>NULL</code>
and a function calling <code>init_refmodel()</code> appropriately (with the assumption
<code>dis = 0</code>) if <code>object</code> is <code>NULL</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object that can be passed to all the functions that take the
reference model fit as the first argument, such as <code><a href="varsel.html">varsel()</a></code>,
<code><a href="cv_varsel.html">cv_varsel()</a></code>, <code><a href="project.html">project()</a></code>, <code><a href="pred-projection.html">proj_linpred()</a></code>, and <code><a href="pred-projection.html">proj_predict()</a></code>.
Usually, the returned object is of class <code>refmodel</code>. However, if <code>object</code></p>


<p>is <code>NULL</code>, the returned object is of class <code>datafit</code> as well as of class
<code>refmodel</code> (with <code>datafit</code> being first). Objects of class <code>datafit</code> are
handled differently at several places throughout this package.</p>
    </div>
    <div id="formula-terms">
    <h2>Formula terms</h2>
    <p>For additive models (still an experimental feature), only <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code> and
<code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">mgcv::t2()</a></code> are currently supported as smooth terms. Furthermore, these need
to be called without any arguments apart from the predictor names (symbols).
For example, for smoothing the effect of a predictor <code>x</code>, only <code>s(x)</code> or
<code>t2(x)</code> are allowed. As another example, for smoothing the joint effect of
two predictors <code>x</code> and <code>z</code>, only <code>s(x, z)</code> or <code>t2(x, z)</code> are allowed (and
analogously for higher-order joint effects, e.g., of three predictors).</p>
    </div>
    <div id="arguments-ref-predfun-proj-predfun-and-div-minimizer">
    <h2>Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code></h2>
    <p>Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code> may be <code>NULL</code>
for using an internal default (see <a href="projpred-package.html">projpred-package</a> for the functions used
by the default divergence minimizer). Otherwise, let \(N\) denote the
number of observations (in case of CV, these may be reduced to each fold),
\(S_{\mathrm{ref}}\) the number of posterior draws for the reference
model's parameters, and \(S_{\mathrm{prj}}\) the number of draws for
the parameters of a submodel that the reference model has been projected onto
(short: the number of projected draws). Then the functions supplied to these
arguments need to have the following prototypes:</p><ul><li><p><code>ref_predfun</code>: <code>ref_predfun(fit, newdata = NULL)</code> where:</p><ul><li><p><code>fit</code> accepts the reference model fit as given in argument <code>object</code>
(but possibly re-fitted to a subset of the observations, as done in
\(K\)-fold CV).</p></li>
<li><p><code>newdata</code> accepts either <code>NULL</code> (for using the original dataset,
typically stored in <code>fit</code>) or data for new observations (at least in the
form of a <code>data.frame</code>).</p></li>
</ul></li>
<li><p><code>proj_predfun</code>: <code>proj_predfun(fits, newdata)</code> where:</p><ul><li><p><code>fits</code> accepts a <code>list</code> of length \(S_{\mathrm{prj}}\)
containing this number of submodel fits. This <code>list</code> is the same as that
returned by <code><a href="project.html">project()</a></code> in its output element <code>submodl</code> (which in turn is
the same as the return value of <code>div_minimizer</code>, except if <code><a href="project.html">project()</a></code>
was used with an <code>object</code> of class <code>vsel</code> based on an L1 search as well
as with <code>refit_prj = FALSE</code>).</p></li>
<li><p><code>newdata</code> accepts data for new observations (at least in the form of a
<code>data.frame</code>).</p></li>
</ul></li>
<li><p><code>div_minimizer</code> does not need to have a specific prototype, but it needs to
be able to be called with the following arguments:</p><ul><li><p><code>formula</code> accepts either a standard <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> with a single response
(if \(S_{\mathrm{prj}} = 1\)) or a <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> with
\(S_{\mathrm{prj}} &gt; 1\) response variables <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code>-ed on
the left-hand side in which case the projection has to be performed for
each of the response variables separately.</p></li>
<li><p><code>data</code> accepts a <code>data.frame</code> to be used for the projection.</p></li>
<li><p><code>family</code> accepts an object of class <code>family</code>.</p></li>
<li><p><code>weights</code> accepts either observation weights (at least in the form of a
numeric vector) or <code>NULL</code> (for using a vector of ones as weights).</p></li>
<li><p><code>projpred_var</code> accepts an \(N \times S_{\mathrm{prj}}\)
matrix of predictive variances (necessary for <span class="pkg">projpred</span>'s internal
GLM fitter).</p></li>
<li><p><code>projpred_regul</code> accepts a single numeric value as supplied to argument
<code>regul</code> of <code><a href="project.html">project()</a></code>, for example.</p></li>
<li><p><code>...</code> accepts further arguments specified by the user.</p></li>
</ul></li>
</ul><p>The return value of these functions needs to be:</p><ul><li><p><code>ref_predfun</code>: an \(N \times S_{\mathrm{ref}}\) matrix.</p></li>
<li><p><code>proj_predfun</code>: an \(N \times S_{\mathrm{prj}}\) matrix.</p></li>
<li><p><code>div_minimizer</code>: a <code>list</code> of length \(S_{\mathrm{prj}}\)
containing this number of submodel fits.</p></li>
</ul></div>
    <div id="argument-extract-model-data">
    <h2>Argument <code>extract_model_data</code></h2>
    <p>The function supplied to argument <code>extract_model_data</code> needs to have the
prototype</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">extract_model_data</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, wrhs <span class="op">=</span> <span class="cn">NULL</span>, orhs <span class="op">=</span> <span class="cn">NULL</span>, extract_y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre><p></p></div>
<p>where:</p><ul><li><p><code>object</code> accepts the reference model fit as given in argument <code>object</code> (but
possibly re-fitted to a subset of the observations, as done in \(K\)-fold
CV).</p></li>
<li><p><code>newdata</code> accepts either <code>NULL</code> (for using the original dataset, typically
stored in <code>object</code>) or data for new observations (at least in the form of a
<code>data.frame</code>).</p></li>
<li><p><code>wrhs</code> accepts at least either <code>NULL</code> (for using a vector of ones) or a
right-hand side formula consisting only of the variable in <code>newdata</code>
containing the weights.</p></li>
<li><p><code>orhs</code> accepts at least either <code>NULL</code> (for using a vector of zeros) or a
right-hand side formula consisting only of the variable in <code>newdata</code>
containing the offsets.</p></li>
<li><p><code>extract_y</code> accepts a single logical value indicating whether output
element <code>y</code> (see below) shall be <code>NULL</code> (<code>TRUE</code>) or not (<code>FALSE</code>).</p></li>
</ul><p>The return value of <code>extract_model_data</code> needs to be a <code>list</code> with elements
<code>y</code>, <code>weights</code>, and <code>offset</code>, each being a numeric vector containing the data
for the response, the observation weights, and the offsets, respectively. An
exception is that <code>y</code> may also be <code>NULL</code> (depending on argument <code>extract_y</code>)
or a <code>factor</code>.</p>
<p>The weights and offsets returned by <code>extract_model_data</code> will be assumed to
hold for the reference model as well as for the submodels.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"rstanarm"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Data:</span></span></span>
<span class="r-in"><span>  <span class="va">dat_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">df_gaussian</span><span class="op">$</span><span class="va">y</span>, <span class="va">df_gaussian</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The "stanreg" fit which will be used as the reference model (with small</span></span></span>
<span class="r-in"><span>  <span class="co"># values for `chains` and `iter`, but only for technical reasons in this</span></span></span>
<span class="r-in"><span>  <span class="co"># example; this is not recommended in general):</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>    QR <span class="op">=</span> <span class="cn">TRUE</span>, chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">500</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">9876</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define the reference model explicitly:</span></span></span>
<span class="r-in"><span>  <span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu">get_refmodel</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ref</span><span class="op">)</span><span class="op">)</span> <span class="co"># gives `"refmodel"`</span></span></span>
<span class="r-in"><span>  <span class="co"># Now see, for example, `?varsel`, `?cv_varsel`, and `?project` for</span></span></span>
<span class="r-in"><span>  <span class="co"># possible post-processing functions. Most of the post-processing functions</span></span></span>
<span class="r-in"><span>  <span class="co"># call get_refmodel() internally at the beginning, so you will rarely need</span></span></span>
<span class="r-in"><span>  <span class="co"># to call get_refmodel() yourself.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># A custom reference model which may be used in a variable selection where</span></span></span>
<span class="r-in"><span>  <span class="co"># the candidate predictors are not a subset of those used for the reference</span></span></span>
<span class="r-in"><span>  <span class="co"># model's predictions:</span></span></span>
<span class="r-in"><span>  <span class="va">ref_cust</span> <span class="op">&lt;-</span> <span class="fu">init_refmodel</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">fit</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X6</span> <span class="op">+</span> <span class="va">X7</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    extract_model_data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">wrhs</span> <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                                  <span class="va">orhs</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">extract_y</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">extract_y</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">resp_form</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">resp_form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">y</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">dat_gauss</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu">projpred</span><span class="fu">:::</span><span class="fu">nlist</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">wrhs</span>, <span class="va">orhs</span>, <span class="va">resp_form</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">projpred</span><span class="fu">::</span><span class="fu"><a href="do_call.html">do_call</a></span><span class="op">(</span><span class="fu">projpred</span><span class="fu">:::</span><span class="va">.extract_model_data</span>, <span class="va">args</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    cvfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">folds</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">kfold</span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="va">fit</span>, K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">folds</span><span class="op">)</span>, save_fits <span class="op">=</span> <span class="cn">TRUE</span>, folds <span class="op">=</span> <span class="va">folds</span>, cores <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">$</span><span class="va">fits</span><span class="op">[</span>, <span class="st">"fit"</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    dis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span>, <span class="st">"sigma"</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Now, the post-processing functions mentioned above (for example,</span></span></span>
<span class="r-in"><span>  <span class="co"># varsel(), cv_varsel(), and project()) may be applied to `ref_cust`.</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "refmodel"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Aki Vehtari.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

