<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reference model and more general information — refmodel-init-get • projpred</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reference model and more general information — refmodel-init-get"><meta name="description" content='Function get_refmodel() is a generic function whose methods usually call
init_refmodel() which is the underlying workhorse (and may also be used
directly without a call to get_refmodel()).
Both, get_refmodel() and init_refmodel(), create an object containing
information needed for the projection predictive variable selection, namely
about the reference model, the submodels, and how the projection should be
carried out. For the sake of simplicity, the documentation may refer to the
resulting object also as "reference model" or "reference model object", even
though it also contains information about the submodels and the projection.
A "typical" reference model object is created by get_refmodel.stanreg() and
brms::get_refmodel.brmsfit(), either implicitly by a call to a top-level
function such as project(), varsel(), and cv_varsel() or explicitly by
a call to get_refmodel(). All non-"typical" reference model objects will be
called "custom" reference model objects.
Some arguments are for \(K\)-fold cross-validation (\(K\)-fold CV) only;
see cv_varsel() for the use of \(K\)-fold CV in projpred.'><meta property="og:description" content='Function get_refmodel() is a generic function whose methods usually call
init_refmodel() which is the underlying workhorse (and may also be used
directly without a call to get_refmodel()).
Both, get_refmodel() and init_refmodel(), create an object containing
information needed for the projection predictive variable selection, namely
about the reference model, the submodels, and how the projection should be
carried out. For the sake of simplicity, the documentation may refer to the
resulting object also as "reference model" or "reference model object", even
though it also contains information about the submodels and the projection.
A "typical" reference model object is created by get_refmodel.stanreg() and
brms::get_refmodel.brmsfit(), either implicitly by a call to a top-level
function such as project(), varsel(), and cv_varsel() or explicitly by
a call to get_refmodel(). All non-"typical" reference model objects will be
called "custom" reference model objects.
Some arguments are for \(K\)-fold cross-validation (\(K\)-fold CV) only;
see cv_varsel() for the use of \(K\)-fold CV in projpred.'><meta property="og:image" content="https://mc-stan.org/projpred/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      projpred
    </a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.9.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/projpred/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Reference model and more general information</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/master/R/refmodel.R" class="external-link"><code>R/refmodel.R</code></a></small>
      <div class="d-none name"><code>refmodel-init-get.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function <code>get_refmodel()</code> is a generic function whose methods usually call
<code>init_refmodel()</code> which is the underlying workhorse (and may also be used
directly without a call to <code>get_refmodel()</code>).</p>
<p>Both, <code>get_refmodel()</code> and <code>init_refmodel()</code>, create an object containing
information needed for the projection predictive variable selection, namely
about the reference model, the submodels, and how the projection should be
carried out. For the sake of simplicity, the documentation may refer to the
resulting object also as "reference model" or "reference model object", even
though it also contains information about the submodels and the projection.</p>
<p>A "typical" reference model object is created by <code>get_refmodel.stanreg()</code> and
<code><a href="https://paulbuerkner.com/brms/reference/get_refmodel.brmsfit.html" class="external-link">brms::get_refmodel.brmsfit()</a></code>, either implicitly by a call to a top-level
function such as <code><a href="project.html">project()</a></code>, <code><a href="varsel.html">varsel()</a></code>, and <code><a href="cv_varsel.html">cv_varsel()</a></code> or explicitly by
a call to <code>get_refmodel()</code>. All non-"typical" reference model objects will be
called "custom" reference model objects.</p>
<p>Some arguments are for \(K\)-fold cross-validation (\(K\)-fold CV) only;
see <code><a href="cv_varsel.html">cv_varsel()</a></code> for the use of \(K\)-fold CV in <span class="pkg">projpred</span>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'refmodel'</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'vsel'</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'projection'</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, family <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'stanreg'</span></span>
<span><span class="fu">get_refmodel</span><span class="op">(</span><span class="va">object</span>, latent <span class="op">=</span> <span class="cn">FALSE</span>, dis <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">init_refmodel</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  ref_predfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  div_minimizer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  proj_predfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extract_model_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cvfun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cvfits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dis <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cvrefbuilder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  called_from_cvrefbuilder <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>For <code>init_refmodel()</code>, an object that the functions from
arguments <code>extract_model_data</code> and <code>ref_predfun</code> can be applied to, with a
<code>NULL</code> object being treated specially (see section "Value" below). For
<code>get_refmodel.default()</code>, an object that function <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code> can be applied
to in order to retrieve the family (if argument <code>family</code> is <code>NULL</code>),
additionally to the properties required for <code>init_refmodel()</code>. For
non-default methods of <code>get_refmodel()</code>, an object of the corresponding
class.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For <code>get_refmodel.default()</code> and <code>get_refmodel.stanreg()</code>:
arguments passed to <code>init_refmodel()</code>. For the <code>get_refmodel()</code> generic:
arguments passed to the appropriate method. For <code>init_refmodel()</code>:
arguments passed to <code><a href="extend_family.html">extend_family()</a></code> (apart from <code>family</code>).</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>An object of class <code>family</code> representing the observation model
(i.e., the distributional family for the response) of the <em>submodels</em>.
(However, the link and the inverse-link function of this <code>family</code> are also
used for quantities like predictions and fitted values related to the
<em>reference model</em>.) May be <code>NULL</code> for <code>get_refmodel.default()</code> in which
case the family is retrieved from <code>object</code>. For custom reference models,
<code>family</code> does not have to coincide with the family of the reference model
(if the reference model possesses a formal <code>family</code> at all). In typical
reference models, however, these families do coincide. Furthermore, the
latent projection is an exception where <code>family</code> is not the family of the
submodels (in that case, the family of the submodels is the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code>
family).</p></dd>


<dt id="arg-latent">latent<a class="anchor" aria-label="anchor" href="#arg-latent"></a></dt>
<dd><p>A single logical value indicating whether to use the latent
projection (<code>TRUE</code>) or not (<code>FALSE</code>). Note that setting <code>latent = TRUE</code>
causes all arguments starting with <code>augdat_</code> to be ignored.</p></dd>


<dt id="arg-dis">dis<a class="anchor" aria-label="anchor" href="#arg-dis"></a></dt>
<dd><p>A vector of posterior draws for the reference model's dispersion
parameter or—more precisely—the posterior values for the reference
model's parameter-conditional predictive variance (assuming that this
variance is the same for all observations). May be <code>NULL</code> if the submodels
have no dispersion parameter or if the submodels do have a dispersion
parameter, but <code>object</code> is <code>NULL</code> (in which case <code>0</code> is used for <code>dis</code>).
Note that for the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code> <code>family</code>, <code>dis</code> is the standard deviation,
not the variance.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code> containing the data to use for the projection
predictive variable selection. Any <code>contrasts</code> attributes of the dataset's
columns are silently removed. For custom reference models, the columns of
<code>data</code> do not necessarily have to coincide with those of the dataset used
for fitting the reference model, but keep in mind that a row-subset of
<code>data</code> is used for argument <code>newdata</code> of <code>ref_predfun</code> during \(K\)-fold
CV.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>The full formula to use for the search procedure. For custom
reference models, this does not necessarily coincide with the reference
model's formula. For general information about formulas in <span style="R">R</span>, see
<code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>. For information about possible right-hand side (i.e.,
predictor) terms in <code>formula</code> here, see the main vignette and section
"Formula terms" below. For multilevel formulas, see also package <span class="pkg">lme4</span>
(in particular, functions <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> and <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">lme4::glmer()</a></code>). For additive
formulas, see also packages <span class="pkg">mgcv</span> (in particular, function
<code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code>) and <span class="pkg">gamm4</span> (in particular, function <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4::gamm4()</a></code>).</p></dd>


<dt id="arg-ref-predfun">ref_predfun<a class="anchor" aria-label="anchor" href="#arg-ref-predfun"></a></dt>
<dd><p>Prediction function for the linear predictor of the
reference model, including offsets (if existing). See also section
"Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>" below. If
<code>object</code> is <code>NULL</code>, <code>ref_predfun</code> is ignored and an internal default is
used instead.</p></dd>


<dt id="arg-div-minimizer">div_minimizer<a class="anchor" aria-label="anchor" href="#arg-div-minimizer"></a></dt>
<dd><p>A function for minimizing the Kullback-Leibler (KL)
divergence from the reference model to a submodel (i.e., for performing the
projection of the reference model onto a submodel). The output of
<code>div_minimizer</code> is used, e.g., by <code>proj_predfun</code>'s argument <code>fits</code>. See
also section "Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>"
below.</p></dd>


<dt id="arg-proj-predfun">proj_predfun<a class="anchor" aria-label="anchor" href="#arg-proj-predfun"></a></dt>
<dd><p>Prediction function for the linear predictor of a
submodel onto which the reference model is projected. See also section
"Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code>" below.</p></dd>


<dt id="arg-extract-model-data">extract_model_data<a class="anchor" aria-label="anchor" href="#arg-extract-model-data"></a></dt>
<dd><p>A function for fetching some variables (response,
observation weights, offsets) from the original dataset (supplied to
argument <code>data</code>) or from a new dataset. May be <code>NULL</code> for using an internal
default that essentially corresponds to <code><a href="y_wobs_offs.html">y_wobs_offs()</a></code>. See also section
"Argument <code>extract_model_data</code>" below.</p></dd>


<dt id="arg-cvfun">cvfun<a class="anchor" aria-label="anchor" href="#arg-cvfun"></a></dt>
<dd><p>For \(K\)-fold CV only. A function that, given a fold indices
vector, fits the reference model separately for each fold and returns the
\(K\) model fits as a <code>list</code>. If <code>object</code> is <code>NULL</code>, <code>cvfun</code> may be
<code>NULL</code> for using an internal default. Only one of <code>cvfits</code> and <code>cvfun</code>
needs to be provided (for \(K\)-fold CV). Note that <code>cvfits</code> takes
precedence over <code>cvfun</code>, i.e., if both are provided, <code>cvfits</code> is used.</p></dd>


<dt id="arg-cvfits">cvfits<a class="anchor" aria-label="anchor" href="#arg-cvfits"></a></dt>
<dd><p>For \(K\)-fold CV only. A <code>list</code> containing the \(K\)
reference model refits from which reference model objects are created. This
<code>list</code> needs to have an attribute called <code>folds</code>, consisting of an integer
vector giving the fold indices (one fold index per observation). Only one
of <code>cvfits</code> and <code>cvfun</code> needs to be provided (for \(K\)-fold CV). Note
that <code>cvfits</code> takes precedence over <code>cvfun</code>, i.e., if both are provided,
<code>cvfits</code> is used.</p></dd>


<dt id="arg-cvrefbuilder">cvrefbuilder<a class="anchor" aria-label="anchor" href="#arg-cvrefbuilder"></a></dt>
<dd><p>For \(K\)-fold CV only. A function that, given a
reference model fit for fold \(k \in \{1, ..., K\}\),
returns an object of the same type as <code>init_refmodel()</code> does. The reference
model fit for fold \(k\) is the \(k\)-th element of the return value of
<code>cvfun</code> or the \(k\)-th element of the <code>list</code> supplied to <code>cvfits</code>
(either here in <code>init_refmodel()</code> or in <code><a href="cv_varsel.html">cv_varsel.refmodel()</a></code>), extended
by elements <code>omitted</code> (containing the indices of the left-out observations
in that fold) and <code>projpred_k</code> (containing the integer \(k\)) if that
\(k\)-th element is a <code>list</code> itself (otherwise, <code>omitted</code> and
<code>projpred_k</code> are appended as attributes). Argument <code>cvrefbuilder</code> may be
<code>NULL</code> for using an internal default: <code>get_refmodel()</code> if <code>object</code> is not
<code>NULL</code> and a function calling <code>init_refmodel()</code> appropriately (with the
assumption <code>dis = 0</code>) if <code>object</code> is <code>NULL</code>.</p></dd>


<dt id="arg-called-from-cvrefbuilder">called_from_cvrefbuilder<a class="anchor" aria-label="anchor" href="#arg-called-from-cvrefbuilder"></a></dt>
<dd><p>A single logical value indicating whether
<code>init_refmodel()</code> is called from a <code>cvrefbuilder</code> function (<code>TRUE</code>) or not
(<code>FALSE</code>). Currently, <code>TRUE</code> only causes some warnings to be suppressed
(warnings which don't need to be thrown for each of the \(K\) reference
model objects because it is sufficient to throw them for the original
reference model object only). This argument is mainly for internal use, but
may also be helpful for users with a custom <code>cvrefbuilder</code> function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object that can be passed to all the functions that take the
reference model fit as the first argument, such as <code><a href="varsel.html">varsel()</a></code>,
<code><a href="cv_varsel.html">cv_varsel()</a></code>, <code><a href="project.html">project()</a></code>, <code><a href="pred-projection.html">proj_linpred()</a></code>, and <code><a href="pred-projection.html">proj_predict()</a></code>.
Usually, the returned object is of class <code>refmodel</code>. However, if <code>object</code>
is <code>NULL</code>, the returned object is of class <code>datafit</code> as well as of class
<code>refmodel</code> (with <code>datafit</code> being first). Objects of class <code>datafit</code> are
handled differently at several places throughout this package.</p>
<p>The elements of the returned object are not meant to be accessed directly
but instead via downstream functions (see the functions mentioned above as
well as <code><a href="predict.refmodel.html">predict.refmodel()</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="formula-terms">Formula terms<a class="anchor" aria-label="anchor" href="#formula-terms"></a></h2>
    <p>Although bad practice (in general), a reference model lacking an intercept
can be used within <span class="pkg">projpred</span>. However, it will always be projected onto
submodels which <em>include</em> an intercept. The reason is that even if the true
intercept in the reference model is zero, this does not need to hold for the
submodels.</p>
<p>In multilevel (group-level) terms, function calls on the right-hand side of
the <code>|</code> character (e.g., <code>(1 | gr(group_variable))</code>, which is possible in
<span class="pkg">brms</span>) are currently not allowed in <span class="pkg">projpred</span>.</p>
<p>For additive models (still an experimental feature), only <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code> and
<code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">mgcv::t2()</a></code> are currently supported as smooth terms. Furthermore, these need
to be called without any arguments apart from the predictor names (symbols).
For example, for smoothing the effect of a predictor <code>x</code>, only <code>s(x)</code> or
<code>t2(x)</code> are allowed. As another example, for smoothing the joint effect of
two predictors <code>x</code> and <code>z</code>, only <code>s(x, z)</code> or <code>t2(x, z)</code> are allowed (and
analogously for higher-order joint effects, e.g., of three predictors). Note
that all smooth terms need to be included in <code>formula</code> (there is no <code>random</code>
argument as in <code><a href="https://mc-stan.org/rstanarm/reference/stan_gamm4.html" class="external-link">rstanarm::stan_gamm4()</a></code>, for example).</p>
    </div>
    <div class="section level2">
    <h2 id="arguments-ref-predfun-proj-predfun-and-div-minimizer">Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code><a class="anchor" aria-label="anchor" href="#arguments-ref-predfun-proj-predfun-and-div-minimizer"></a></h2>
    <p>Arguments <code>ref_predfun</code>, <code>proj_predfun</code>, and <code>div_minimizer</code> may be <code>NULL</code>
for using an internal default (see <a href="projpred-package.html">projpred-package</a> for the functions used
by the default divergence minimizers). Otherwise, let \(N\) denote the
number of observations (in case of CV, these may be reduced to each fold),
\(S_{\mathrm{ref}}\) the number of posterior draws for the reference
model's parameters, and \(S_{\mathrm{prj}}\) the number of draws for
the parameters of a submodel that the reference model has been projected onto
(short: the number of projected draws). For the augmented-data projection,
let \(C_{\mathrm{cat}}\) denote the number of response categories,
\(C_{\mathrm{lat}}\) the number of latent response categories (which
typically equals \(C_{\mathrm{cat}} - 1\)), and define
\(N_{\mathrm{augcat}} := N \cdot C_{\mathrm{cat}}\)
as well as \(N_{\mathrm{auglat}} := N \cdot C_{\mathrm{lat}}\). Then the functions supplied to these arguments need to have the
following prototypes:</p><ul><li><p><code>ref_predfun</code>: <code>ref_predfun(fit, newdata = NULL)</code> where:</p><ul><li><p><code>fit</code> accepts the reference model fit as given in argument <code>object</code>
(but possibly refitted to a subset of the observations, as done in
\(K\)-fold CV).</p></li>
<li><p><code>newdata</code> accepts either <code>NULL</code> (for using the original dataset,
typically stored in <code>fit</code>) or data for new observations (at least in the
form of a <code>data.frame</code>).</p></li>
</ul></li>
<li><p><code>proj_predfun</code>: <code>proj_predfun(fits, newdata)</code> where:</p><ul><li><p><code>fits</code> accepts a <code>list</code> of length \(S_{\mathrm{prj}}\)
containing this number of submodel fits. This <code>list</code> is the same as that
returned by <code><a href="project.html">project()</a></code> in its output element <code>outdmin</code> (which in turn is
the same as the return value of <code>div_minimizer</code>, except if <code><a href="project.html">project()</a></code>
was used with an <code>object</code> of class <code>vsel</code> based on an L1 search as well
as with <code>refit_prj = FALSE</code>).</p></li>
<li><p><code>newdata</code> accepts data for new observations (at least in the form of a
<code>data.frame</code>).</p></li>
</ul></li>
<li><p><code>div_minimizer</code> does not need to have a specific prototype, but it needs to
be able to be called with the following arguments:</p><ul><li><p><code>formula</code> accepts either a standard <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> with a single response
(if \(S_{\mathrm{prj}} = 1\) or in case of the
augmented-data projection) or a <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> with \(S_{\mathrm{prj}} &gt;
    1\) response variables <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code>-ed on the left-hand side in
which case the projection has to be performed for each of the response
variables separately.</p></li>
<li><p><code>data</code> accepts a <code>data.frame</code> to be used for the projection. In case of
the traditional or the latent projection, this dataset has \(N\) rows.
In case of the augmented-data projection, this dataset has
\(N_{\mathrm{augcat}}\) rows.</p></li>
<li><p><code>family</code> accepts an object of class <code>family</code>.</p></li>
<li><p><code>weights</code> accepts either observation weights (at least in the form of a
numeric vector) or <code>NULL</code> (for using a vector of ones as weights).</p></li>
<li><p><code>projpred_var</code> accepts an \(N \times S_{\mathrm{prj}}\)
matrix of predictive variances (necessary for <span class="pkg">projpred</span>'s internal
GLM fitter) in case of the traditional or the latent projection and an
\(N_{\mathrm{augcat}} \times S_{\mathrm{prj}}\)
matrix (containing only <code>NA</code>s) in case of the augmented-data projection.</p></li>
<li><p><code>projpred_ws_aug</code> accepts an \(N \times S_{\mathrm{prj}}\)
matrix of expected values for the response in case of the traditional or
the latent projection and an \(N_{\mathrm{augcat}} \times
    S_{\mathrm{prj}}\) matrix of probabilities for the
response categories in case of the augmented-data projection.</p></li>
<li><p><code>...</code> accepts further arguments specified by the user (or by
<span class="pkg">projpred</span>).</p></li>
</ul></li>
</ul><p>The return value of these functions needs to be:</p><ul><li><p><code>ref_predfun</code>: for the traditional or the latent projection, an \(N
\times S_{\mathrm{ref}}\) matrix; for the augmented-data
projection, an \(S_{\mathrm{ref}} \times N \times C_{\mathrm{lat}}\) array (the only exception is the augmented-data projection for
the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> family in which case <code>ref_predfun</code> needs to return an \(N
\times S_{\mathrm{ref}}\) matrix just like for the traditional
projection because the array is constructed by an internal wrapper function).</p></li>
<li><p><code>proj_predfun</code>: for the traditional or the latent projection, an \(N
\times S_{\mathrm{prj}}\) matrix; for the augmented-data
projection, an \(N \times C_{\mathrm{lat}} \times S_{\mathrm{prj}}\) array.</p></li>
<li><p><code>div_minimizer</code>: a <code>list</code> of length \(S_{\mathrm{prj}}\)
containing this number of submodel fits.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="argument-extract-model-data">Argument <code>extract_model_data</code><a class="anchor" aria-label="anchor" href="#argument-extract-model-data"></a></h2>
    <p>The function supplied to argument <code>extract_model_data</code> needs to have the
prototype</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">extract_model_data</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, wrhs <span class="op">=</span> <span class="cn">NULL</span>, orhs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   extract_y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre><p></p></div>
<p>where:</p><ul><li><p><code>object</code> accepts the reference model fit as given in argument <code>object</code> (but
possibly refitted to a subset of the observations, as done in \(K\)-fold
CV).</p></li>
<li><p><code>newdata</code> accepts data for new observations (at least in the form of a
<code>data.frame</code>).</p></li>
<li><p><code>wrhs</code> accepts at least (i) a right-hand side formula consisting only of
the variable in <code>newdata</code> containing the observation weights or (ii) <code>NULL</code>
for using the observation weights corresponding to <code>newdata</code> (typically, the
observation weights are stored in a column of <code>newdata</code>; if the model was
fitted without observation weights, a vector of ones should be used).</p></li>
<li><p><code>orhs</code> accepts at least (i) a right-hand side formula consisting only of
the variable in <code>newdata</code> containing the offsets or (ii) <code>NULL</code> for using the
offsets corresponding to <code>newdata</code> (typically, the offsets are stored in a
column of <code>newdata</code>; if the model was fitted without offsets, a vector of
zeros should be used).</p></li>
<li><p><code>extract_y</code> accepts a single logical value indicating whether output
element <code>y</code> (see below) shall be <code>NULL</code> (<code>TRUE</code>) or not (<code>FALSE</code>).</p></li>
</ul><p>The return value of <code>extract_model_data</code> needs to be a <code>list</code> with elements
<code>y</code>, <code>weights</code>, and <code>offset</code>, each being a numeric vector containing the data
for the response, the observation weights, and the offsets, respectively. An
exception is that <code>y</code> may also be <code>NULL</code> (depending on argument <code>extract_y</code>),
a non-numeric vector, or a <code>factor</code>.</p>
<p>The weights and offsets returned by <code>extract_model_data</code> will be assumed to
hold for the reference model as well as for the submodels.</p>
<p>Above, arguments <code>wrhs</code> and <code>orhs</code> were assumed to have defaults of <code>NULL</code>.
It should be possible to use defaults other than <code>NULL</code>, but we strongly
recommend to use <code>NULL</code>. If defaults other than <code>NULL</code> are used, they need to
imply the behaviors described at items "(ii)" (see the descriptions of <code>wrhs</code>
and <code>orhs</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="augmented-data-projection">Augmented-data projection<a class="anchor" aria-label="anchor" href="#augmented-data-projection"></a></h2>
    <p>If a custom reference model for an augmented-data projection is needed, see
also <code><a href="extend_family.html">extend_family()</a></code>.</p>
<p>For the augmented-data projection, the response vector resulting from
<code>extract_model_data</code> is internally coerced to a <code>factor</code> (using
<code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>). The levels of this <code>factor</code> have to be identical to
<code>family$cats</code> (<em>after</em> applying <code><a href="extend_family.html">extend_family()</a></code> internally; see
<code><a href="extend_family.html">extend_family()</a></code>'s argument <code>augdat_y_unqs</code>).</p>
<p>Note that response-specific offsets (i.e., one length-\(N\) offset vector
per response category) are not supported by <span class="pkg">projpred</span> yet. So far, only
offsets which are the same across all response categories are supported. This
is why in case of the <code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">brms::categorical()</a></code> family, offsets are currently not
supported at all.</p>
<p>Currently, <code>object = NULL</code> (i.e., a <code>datafit</code>; see section "Value") is not
supported in case of the augmented-data projection.</p>
    </div>
    <div class="section level2">
    <h2 id="latent-projection">Latent projection<a class="anchor" aria-label="anchor" href="#latent-projection"></a></h2>
    <p>If a custom reference model for a latent projection is needed, see also
<code><a href="extend_family.html">extend_family()</a></code>.</p>
<p>For the latent projection, <code>family$cats</code> (<em>after</em> applying <code><a href="extend_family.html">extend_family()</a></code>
internally; see <code><a href="extend_family.html">extend_family()</a></code>'s argument <code>latent_y_unqs</code>) currently must
not be <code>NULL</code> if the original (i.e., non-latent) response is a <code>factor</code>.
Conversely, if <code>family$cats</code> (<em>after</em> applying <code><a href="extend_family.html">extend_family()</a></code>) is
non-<code>NULL</code>, the response vector resulting from <code>extract_model_data</code> is
internally coerced to a <code>factor</code> (using <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>). The levels of this
<code>factor</code> have to be identical to that non-<code>NULL</code> element <code>family$cats</code>.</p>
<p>Currently, <code>object = NULL</code> (i.e., a <code>datafit</code>; see section "Value") is not
supported in case of the latent projection.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Data:</span></span></span>
<span class="r-in"><span><span class="va">dat_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">df_gaussian</span><span class="op">$</span><span class="va">y</span>, <span class="va">df_gaussian</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `stanreg` fit which will be used as the reference model (with small</span></span></span>
<span class="r-in"><span><span class="co"># values for `chains` and `iter`, but only for technical reasons in this</span></span></span>
<span class="r-in"><span><span class="co"># example; this is not recommended in general):</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>  QR <span class="op">=</span> <span class="cn">TRUE</span>, chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">500</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">9876</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the reference model object explicitly:</span></span></span>
<span class="r-in"><span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu">get_refmodel</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ref</span><span class="op">)</span><span class="op">)</span> <span class="co"># gives `"refmodel"`</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "refmodel"</span>
<span class="r-in"><span><span class="co"># Now see, for example, `?varsel`, `?cv_varsel`, and `?project` for</span></span></span>
<span class="r-in"><span><span class="co"># possible post-processing functions. Most of the post-processing functions</span></span></span>
<span class="r-in"><span><span class="co"># call get_refmodel() internally at the beginning, so you will rarely need</span></span></span>
<span class="r-in"><span><span class="co"># to call get_refmodel() yourself.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A custom reference model object which may be used in a variable selection</span></span></span>
<span class="r-in"><span><span class="co"># where the candidate predictors are not a subset of those used for the</span></span></span>
<span class="r-in"><span><span class="co"># reference model's predictions:</span></span></span>
<span class="r-in"><span><span class="va">ref_cust</span> <span class="op">&lt;-</span> <span class="fu">init_refmodel</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X6</span> <span class="op">+</span> <span class="va">X7</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cvfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">folds</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">kfold</span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="va">fit</span>, K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">folds</span><span class="op">)</span>, save_fits <span class="op">=</span> <span class="cn">TRUE</span>, folds <span class="op">=</span> <span class="va">folds</span>, cores <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">$</span><span class="va">fits</span><span class="op">[</span>, <span class="st">"fit"</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  dis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span>, <span class="st">"sigma"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  cvrefbuilder <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">init_refmodel</span><span class="op">(</span><span class="va">cvfit</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">dat_gauss</span><span class="op">[</span><span class="op">-</span><span class="va">cvfit</span><span class="op">$</span><span class="va">omitted</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X6</span> <span class="op">+</span> <span class="va">X7</span>,</span></span>
<span class="r-in"><span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  dis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span><span class="op">[</span>, <span class="st">"sigma"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                  called_from_cvrefbuilder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Now, the post-processing functions mentioned above (for example,</span></span></span>
<span class="r-in"><span><span class="co"># varsel(), cv_varsel(), and project()) may be applied to `ref_cust`.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Osvaldo Martin, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

