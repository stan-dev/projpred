<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run search and performance evaluation with cross-validation — cv_varsel • projpred</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run search and performance evaluation with cross-validation — cv_varsel"><meta name="description" content='Run the search part and the evaluation part for a projection predictive
variable selection. The search part determines the predictor ranking (also
known as solution path), i.e., the best submodel for each submodel size
(number of predictor terms). The evaluation part determines the predictive
performance of the submodels along the predictor ranking. In contrast to
varsel(), cv_varsel() performs a cross-validation (CV) by running the
search part with the training data of each CV fold separately (an exception
is explained in section "Note" below) and by running the evaluation part on
the corresponding test set of each CV fold. A special method is
cv_varsel.vsel() because it re-uses the search results from an earlier
cv_varsel() (or varsel()) run, as illustrated in the main vignette.'><meta property="og:description" content='Run the search part and the evaluation part for a projection predictive
variable selection. The search part determines the predictor ranking (also
known as solution path), i.e., the best submodel for each submodel size
(number of predictor terms). The evaluation part determines the predictive
performance of the submodels along the predictor ranking. In contrast to
varsel(), cv_varsel() performs a cross-validation (CV) by running the
search part with the training data of each CV fold separately (an exception
is explained in section "Note" below) and by running the evaluation part on
the corresponding test set of each CV fold. A special method is
cv_varsel.vsel() because it re-uses the search results from an earlier
cv_varsel() (or varsel()) run, as illustrated in the main vignette.'><meta property="og:image" content="https://mc-stan.org/projpred/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      projpred
    </a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.9.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/projpred/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Run search and performance evaluation with cross-validation</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/fix-favicons/R/cv_varsel.R" class="external-link"><code>R/cv_varsel.R</code></a></small>
      <div class="d-none name"><code>cv_varsel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run the <em>search</em> part and the <em>evaluation</em> part for a projection predictive
variable selection. The search part determines the predictor ranking (also
known as solution path), i.e., the best submodel for each submodel size
(number of predictor terms). The evaluation part determines the predictive
performance of the submodels along the predictor ranking. In contrast to
<code><a href="varsel.html">varsel()</a></code>, <code>cv_varsel()</code> performs a cross-validation (CV) by running the
search part with the training data of each CV fold separately (an exception
is explained in section "Note" below) and by running the evaluation part on
the corresponding test set of each CV fold. A special method is
<code>cv_varsel.vsel()</code> because it re-uses the search results from an earlier
<code>cv_varsel()</code> (or <code><a href="varsel.html">varsel()</a></code>) run, as illustrated in the main vignette.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cv_varsel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">cv_varsel</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'vsel'</span></span>
<span><span class="fu">cv_varsel</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  cv_method <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">cv_method</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="st">"LOO"</span>,</span>
<span>  nloo <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">nloo</span>,</span>
<span>  K <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">K</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"datafit"</span><span class="op">)</span><span class="op">)</span> <span class="fl">5</span> <span class="kw">else</span> <span class="fl">10</span>,</span>
<span>  cvfits <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">cvfits</span>,</span>
<span>  validate_search <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">validate_search</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'refmodel'</span></span>
<span><span class="fu">cv_varsel</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"forward"</span>,</span>
<span>  cv_method <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"datafit"</span><span class="op">)</span><span class="op">)</span> <span class="st">"LOO"</span> <span class="kw">else</span> <span class="st">"kfold"</span>,</span>
<span>  ndraws <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nclusters <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  ndraws_pred <span class="op">=</span> <span class="fl">400</span>,</span>
<span>  nclusters_pred <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  refit_prj <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"datafit"</span><span class="op">)</span>,</span>
<span>  nterms_max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"projpred.verbose"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nloo <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">cv_method</span> <span class="op">==</span> <span class="st">"LOO"</span><span class="op">)</span> <span class="va">object</span><span class="op">$</span><span class="va">nobs</span> <span class="kw">else</span> <span class="cn">NULL</span>,</span>
<span>  K <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"datafit"</span><span class="op">)</span><span class="op">)</span> <span class="fl">5</span> <span class="kw">else</span> <span class="fl">10</span>,</span>
<span>  cvfits <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">cvfits</span>,</span>
<span>  search_control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambda_min_ratio <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  nlambda <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  validate_search <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  search_terms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  search_out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"projpred.parallel_cv"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>refmodel</code> (returned by <code><a href="refmodel-init-get.html">get_refmodel()</a></code> or
<code><a href="refmodel-init-get.html">init_refmodel()</a></code>) or an object that can be passed to argument <code>object</code> of
<code><a href="refmodel-init-get.html">get_refmodel()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For <code>cv_varsel.default()</code>: Arguments passed to <code><a href="refmodel-init-get.html">get_refmodel()</a></code> as
well as to <code>cv_varsel.refmodel()</code>. For <code>cv_varsel.vsel()</code>: Arguments passed
to <code>cv_varsel.refmodel()</code>. For <code>cv_varsel.refmodel()</code>: Arguments passed to
the divergence minimizer (see argument <code>div_minimizer</code> of <code><a href="refmodel-init-get.html">init_refmodel()</a></code>
as well as section "Draw-wise divergence minimizers" of <a href="projpred-package.html">projpred-package</a>)
when refitting the submodels for the performance evaluation (if <code>refit_prj</code>
is <code>TRUE</code>).</p></dd>


<dt id="arg-cv-method">cv_method<a class="anchor" aria-label="anchor" href="#arg-cv-method"></a></dt>
<dd><p>The CV method, either <code>"LOO"</code> or <code>"kfold"</code>. In the <code>"LOO"</code>
case, a Pareto-smoothed importance sampling leave-one-out CV (PSIS-LOO CV)
is performed, which avoids refitting the reference model <code>nloo</code> times (in
contrast to a standard LOO-CV). In the <code>"kfold"</code> case, a \(K\)-fold CV is
performed. See also section "Note" below.</p></dd>


<dt id="arg-nloo">nloo<a class="anchor" aria-label="anchor" href="#arg-nloo"></a></dt>
<dd><p>Only relevant if <code>cv_method = "LOO"</code> and <code>validate_search = TRUE</code>. If <code>nloo &gt; 0</code> is smaller than the number of all observations, full
LOO-CV (i.e., PSIS-LOO CV with <code>validate_search = TRUE</code> and with <code>nloo = n</code>
where <code>n</code> denotes the number of all observations) is approximated by
subsampled LOO-CV, i.e., by combining the fast (i.e., <code>validate_search = FALSE</code>) LOO result for the selected models and <code>nloo</code> leave-one-out
searches using the difference estimator with simple random sampling (SRS)
without replacement (WOR) (Magnusson et al., 2020). Smaller <code>nloo</code> values
lead to faster computation, but higher uncertainty in the evaluation part.
If <code>NULL</code>, all observations are used (as by default). Note that performance
statistic <code>"auc"</code> (see argument <code>stats</code> of <code><a href="summary.vsel.html">summary.vsel()</a></code> and
<code><a href="plot.vsel.html">plot.vsel()</a></code>) is not supported in case of subsampled LOO-CV. Furthermore,
option <code>"best"</code> for argument <code>baseline</code> of <code><a href="summary.vsel.html">summary.vsel()</a></code> and
<code><a href="plot.vsel.html">plot.vsel()</a></code> is not supported in case of subsampled LOO-CV.</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Only relevant if <code>cv_method = "kfold"</code> and if <code>cvfits</code> is <code>NULL</code>
(which is the case for reference model objects created by
<code><a href="refmodel-init-get.html">get_refmodel.stanreg()</a></code> or <code><a href="https://paulbuerkner.com/brms/reference/get_refmodel.brmsfit.html" class="external-link">brms::get_refmodel.brmsfit()</a></code>). Number of
folds in \(K\)-fold CV.</p></dd>


<dt id="arg-cvfits">cvfits<a class="anchor" aria-label="anchor" href="#arg-cvfits"></a></dt>
<dd><p>Only relevant if <code>cv_method = "kfold"</code>. The same as argument
<code>cvfits</code> of <code><a href="refmodel-init-get.html">init_refmodel()</a></code>, but repeated here so that output from
<code><a href="run_cvfun.html">run_cvfun()</a></code> can be inserted here straightforwardly.</p></dd>


<dt id="arg-validate-search">validate_search<a class="anchor" aria-label="anchor" href="#arg-validate-search"></a></dt>
<dd><p>A single logical value indicating whether to
cross-validate also the search part, i.e., whether to run the search
separately for each CV fold (<code>TRUE</code>) or not (<code>FALSE</code>). With <code>FALSE</code>,
the computation is faster, but the predictive performance estimates
of the selected submodels are optimistically biased. However, these fast
biased estimates can be useful to obtain initial information on the
usefulness of projection predictive variable selection.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>The method for the search part. Possible options are
<code>"forward"</code> for forward search and <code>"L1"</code> for L1 search. See also section
"Details" below.</p></dd>


<dt id="arg-ndraws">ndraws<a class="anchor" aria-label="anchor" href="#arg-ndraws"></a></dt>
<dd><p>Number of posterior draws used in the search part. Ignored if
<code>nclusters</code> is not <code>NULL</code> or in case of L1 search (because L1 search always
uses a single cluster). If both (<code>nclusters</code> and <code>ndraws</code>) are <code>NULL</code>, the
number of posterior draws from the reference model is used for <code>ndraws</code>.
See also section "Details" below.</p></dd>


<dt id="arg-nclusters">nclusters<a class="anchor" aria-label="anchor" href="#arg-nclusters"></a></dt>
<dd><p>Number of clusters of posterior draws used in the search
part. Ignored in case of L1 search (because L1 search always uses a single
cluster). For the meaning of <code>NULL</code>, see argument <code>ndraws</code>. See also
section "Details" below.</p></dd>


<dt id="arg-ndraws-pred">ndraws_pred<a class="anchor" aria-label="anchor" href="#arg-ndraws-pred"></a></dt>
<dd><p>Only relevant if <code>refit_prj</code> is <code>TRUE</code>. Number of
posterior draws used in the evaluation part. Ignored if <code>nclusters_pred</code> is
not <code>NULL</code>. If both (<code>nclusters_pred</code> and <code>ndraws_pred</code>) are <code>NULL</code>, the
number of posterior draws from the reference model is used for
<code>ndraws_pred</code>. See also section "Details" below.</p></dd>


<dt id="arg-nclusters-pred">nclusters_pred<a class="anchor" aria-label="anchor" href="#arg-nclusters-pred"></a></dt>
<dd><p>Only relevant if <code>refit_prj</code> is <code>TRUE</code>. Number of
clusters of posterior draws used in the evaluation part. For the meaning of
<code>NULL</code>, see argument <code>ndraws_pred</code>. See also section "Details" below.</p></dd>


<dt id="arg-refit-prj">refit_prj<a class="anchor" aria-label="anchor" href="#arg-refit-prj"></a></dt>
<dd><p>For the evaluation part, should the projections onto the
submodels along the predictor ranking be performed again using <code>ndraws_pred</code>
draws or <code>nclusters_pred</code> clusters (<code>TRUE</code>) or should their projections from
the search part, which used <code>ndraws</code> draws or <code>nclusters</code> clusters, be re-used
(<code>FALSE</code>)?</p></dd>


<dt id="arg-nterms-max">nterms_max<a class="anchor" aria-label="anchor" href="#arg-nterms-max"></a></dt>
<dd><p>Maximum submodel size (number of predictor terms) up to
which the search is continued. If <code>NULL</code>, then <code>min(19, D)</code> is used where
<code>D</code> is the number of terms in the reference model (or in <code>search_terms</code>, if
supplied). Note that <code>nterms_max</code> does not count the intercept, so use
<code>nterms_max = 0</code> for the intercept-only model. (Correspondingly, <code>D</code> above
does not count the intercept.)</p></dd>


<dt id="arg-penalty">penalty<a class="anchor" aria-label="anchor" href="#arg-penalty"></a></dt>
<dd><p>Only relevant for L1 search. A numeric vector determining the
relative penalties or costs for the predictors. A value of <code>0</code> means that
those predictors have no cost and will therefore be selected first, whereas
<code>Inf</code> means those predictors will never be selected. If <code>NULL</code>, then <code>1</code> is
used for each predictor.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A single integer value from the set \(\{0, 1, 2, 3,
  4\}\) (for <code><a href="varsel.html">varsel()</a></code>, \(3\) and \(4\) have the same
effect), indicating how much information (if any) to print out during the
computations. Higher values indicate that more information should be
printed, <code>0</code> deactivates the verbose mode. Internally, argument <code>verbose</code>
is coerced to integer via <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer()</a></code>, so technically, a single logical
value or a single numeric value work as well.</p></dd>


<dt id="arg-search-control">search_control<a class="anchor" aria-label="anchor" href="#arg-search-control"></a></dt>
<dd><p>A <code>list</code> of "control" arguments (i.e., tuning
parameters) for the search. In case of forward search, these arguments are
passed to the divergence minimizer (see argument <code>div_minimizer</code> of
<code><a href="refmodel-init-get.html">init_refmodel()</a></code> as well as section "Draw-wise divergence minimizers" of
<a href="projpred-package.html">projpred-package</a>). In case of forward search, <code>NULL</code> causes <code>...</code> to be
used not only for the performance evaluation, but also for the search. In
case of L1 search, possible arguments are:</p><ul><li><p><code>lambda_min_ratio</code>: Ratio between the smallest and largest lambda in the
L1-penalized search (default: <code>1e-5</code>). This parameter essentially
determines how long the search is carried out, i.e., how large submodels
are explored. No need to change this unless the program gives a warning
about this.</p></li>
<li><p><code>nlambda</code>: Number of values in the lambda grid for L1-penalized search
(default: <code>150</code>). No need to change this unless the program gives a warning
about this.</p></li>
<li><p><code>thresh</code>: Convergence threshold when computing the L1 path (default:
<code>1e-6</code>). Usually, there is no need to change this.</p></li>
</ul></dd>


<dt id="arg-lambda-min-ratio">lambda_min_ratio<a class="anchor" aria-label="anchor" href="#arg-lambda-min-ratio"></a></dt>
<dd><p>Deprecated (please use <code>search_control</code> instead).
Only relevant for L1 search. Ratio between the smallest and largest lambda
in the L1-penalized search. This parameter essentially determines how long
the search is carried out, i.e., how large submodels are explored. No need
to change this unless the program gives a warning about this.</p></dd>


<dt id="arg-nlambda">nlambda<a class="anchor" aria-label="anchor" href="#arg-nlambda"></a></dt>
<dd><p>Deprecated (please use <code>search_control</code> instead). Only
relevant for L1 search. Number of values in the lambda grid for
L1-penalized search. No need to change this unless the program gives a
warning about this.</p></dd>


<dt id="arg-thresh">thresh<a class="anchor" aria-label="anchor" href="#arg-thresh"></a></dt>
<dd><p>Deprecated (please use <code>search_control</code> instead). Only relevant
for L1 search. Convergence threshold when computing the L1 path. Usually,
there is no need to change this.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Pseudorandom number generation (PRNG) seed by which the same
results can be obtained again if needed. Passed to argument <code>seed</code> of
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>, but can also be <code>NA</code> to not call <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> at all. If not
<code>NA</code>, then the PRNG state is reset (to the state before calling
<code>cv_varsel()</code>) upon exiting <code>cv_varsel()</code>. Here, <code>seed</code> is used for
clustering the reference model's posterior draws (if <code>!is.null(nclusters)</code>
or <code>!is.null(nclusters_pred)</code>), for subsampling PSIS-LOO CV folds (if
<code>nloo</code> is smaller than the number of observations), for sampling the folds
in \(K\)-fold CV, and for drawing new group-level effects when predicting
from a multilevel submodel (however, not yet in case of a GAMM).</p></dd>


<dt id="arg-search-terms">search_terms<a class="anchor" aria-label="anchor" href="#arg-search-terms"></a></dt>
<dd><p>Only relevant for forward search. A custom character
vector of predictor term blocks to consider for the search. Section
"Details" below describes more precisely what "predictor term block" means.
The intercept (<code>"1"</code>) is always included internally via <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">union()</a></code>, so
there's no difference between including it explicitly or omitting it. The
default <code>search_terms</code> considers all the terms in the reference model's
formula.</p></dd>


<dt id="arg-search-out">search_out<a class="anchor" aria-label="anchor" href="#arg-search-out"></a></dt>
<dd><p>Intended for internal use.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>A single logical value indicating whether to run costly parts
of the CV in parallel (<code>TRUE</code>) or not (<code>FALSE</code>). See also section "Note"
below as well as section "Parallelization" in <a href="projpred-package.html">projpred-package</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>vsel</code>. The elements of this object are not meant
to be accessed directly but instead via helper functions (see the main
vignette and <a href="projpred-package.html">projpred-package</a>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Arguments <code>ndraws</code>, <code>nclusters</code>, <code>nclusters_pred</code>, and <code>ndraws_pred</code>
are automatically truncated at the number of posterior draws in the
reference model (which is <code>1</code> for <code>datafit</code>s). Using less draws or clusters
in <code>ndraws</code>, <code>nclusters</code>, <code>nclusters_pred</code>, or <code>ndraws_pred</code> than posterior
draws in the reference model may result in slightly inaccurate projection
performance. Increasing these arguments affects the computation time
linearly.</p>
<p>For argument <code>method</code>, there are some restrictions: For a reference model
with multilevel or additive formula terms or a reference model set up for
the augmented-data projection, only the forward search is available.
Furthermore, argument <code>search_terms</code> requires a forward search to take
effect.</p>
<p>L1 search is faster than forward search, but forward search may be more
accurate. Furthermore, forward search may find a sparser model with
comparable performance to that found by L1 search, but it may also
overfit when more predictors are added. This overfit can be detected
by running search validation (see <code>cv_varsel()</code>).</p>
<p>An L1 search may select an interaction term before all involved lower-order
interaction terms (including main-effect terms) have been selected. In
<span class="pkg">projpred</span> versions &gt; 2.6.0, the resulting predictor ranking is
automatically modified so that the lower-order interaction terms come
before this interaction term, but if this is conceptually undesired, choose
the forward search instead.</p>
<p>The elements of the <code>search_terms</code> character vector don't need to be
individual predictor terms. Instead, they can be building blocks consisting
of several predictor terms connected by the <code>+</code> symbol. To understand how
these building blocks work, it is important to know how <span class="pkg">projpred</span>'s
forward search works: It starts with an empty vector <code>chosen</code> which will
later contain already selected predictor terms. Then, the search iterates
over model sizes \(j \in \{0, ..., J\}\) (with \(J\)
denoting the maximum submodel size, not counting the intercept). The
candidate models at model size \(j\) are constructed from those elements
from <code>search_terms</code> which yield model size \(j\) when combined with the
<code>chosen</code> predictor terms. Note that sometimes, there may be no candidate
models for model size \(j\). Also note that internally, <code>search_terms</code> is
expanded to include the intercept (<code>"1"</code>), so the first step of the search
(model size 0) always consists of the intercept-only model as the only
candidate.</p>
<p>As a <code>search_terms</code> example, consider a reference model with formula <code>y ~ x1 + x2 + x3</code>. Then, to ensure that <code>x1</code> is always included in the
candidate models, specify <code>search_terms = c("x1", "x1 + x2", "x1 + x3", "x1 + x2 + x3")</code> (or, in a simpler way that leads to the same results,
<code>search_terms = c("x1", "x1 + x2", "x1 + x3")</code>, for which helper function
<code><a href="force_search_terms.html">force_search_terms()</a></code> exists). This search would start with <code>y ~ 1</code> as the
only candidate at model size 0. At model size 1, <code>y ~ x1</code> would be the only
candidate. At model size 2, <code>y ~ x1 + x2</code> and <code>y ~ x1 + x3</code> would be the
two candidates. At the last model size of 3, <code>y ~ x1 + x2 + x3</code> would be
the only candidate. As another example, to exclude <code>x1</code> from the search,
specify <code>search_terms = c("x2", "x3", "x2 + x3")</code> (or, in a simpler way
that leads to the same results, <code>search_terms = c("x2", "x3")</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If <code>validate_search</code> is <code>FALSE</code>, the search is not included in the CV
so that only a single full-data search is run. If the number of
observations is large, the fast PSIS-LOO CV along the full-data search path
is likely to be accurate. If the number of observations is small or
moderate, the fast PSIS-LOO CV along the full-data search path is likely to
have optimistic bias in the middle of the search path. This result can be
used to guide further actions and the optimistic bias can be greatly
reduced by using <code>validate_search = TRUE</code>.</p>
<p>PSIS uses the Pareto-\(\hat{k}\) diagnostic to assess the reliability of
PSIS-LOO CV. Global option <code>projpred.warn_psis</code> (default <code>TRUE</code>) controls
whether the Pareto-\(\hat{k}\) diagnostics may result in warnings. See
<a href="https://mc-stan.org/loo/reference/loo-glossary.html" class="external-link">loo::loo-glossary</a> for how to interpret the Pareto-\(\hat{k}\) values
and the warning thresholds. <span class="pkg">projpred</span> does not support the usually
recommended moment-matching (see <code><a href="https://mc-stan.org/loo/reference/loo_moment_match.html" class="external-link">loo::loo_moment_match()</a></code> and
<code><a href="https://paulbuerkner.com/brms/reference/loo_moment_match.brmsfit.html" class="external-link">brms::loo_moment_match()</a></code>), mixture importance sampling
(<code><a href="https://mc-stan.org/loo/articles/loo2-mixis.html" class="external-link">vignette("loo2-mixis", package="loo")</a></code>), or <code>reloo</code>-ing
(<code><a href="https://paulbuerkner.com/brms/reference/reloo.brmsfit.html" class="external-link">brms::reloo()</a></code>). If the reference model PSIS-LOO CV Pareto-\(\hat{k}\)
values are good, but there are high Pareto-\(\hat{k}\) values for the
projected models, you can try increasing the number of draws used for the
PSIS-LOO CV (<code>ndraws</code> in case of <code>refit_prj = FALSE</code>; <code>ndraws_pred</code> in case
of <code>refit_prj = TRUE</code>). If increasing the number of draws does not help and
if the reference model PSIS-LOO CV Pareto-\(\hat{k}\) values are high,
and the reference model PSIS-LOO CV results change substantially when using
moment-matching, mixture importance sampling, or <code>reloo</code>-ing, we recommend
to use \(K\)-fold CV within <code>projpred</code>.</p>
<p>For PSIS-LOO CV, <span class="pkg">projpred</span> calls <code><a href="https://mc-stan.org/loo/reference/psis.html" class="external-link">loo::psis()</a></code> (or, exceptionally,
<code><a href="https://mc-stan.org/loo/reference/sis.html" class="external-link">loo::sis()</a></code>, see below) with <code>r_eff = NA</code>. This is only a problem if there
was extreme autocorrelation between the MCMC iterations when the reference
model was built. In those cases however, the reference model should not
have been used anyway, so we don't expect <span class="pkg">projpred</span>'s <code>r_eff = NA</code> to
be a problem.</p>
<p>PSIS cannot be used if the number of draws or clusters is too small. In
such cases, <span class="pkg">projpred</span> resorts to standard importance sampling (SIS)
and shows a message about this. Throughout the documentation, the term
"PSIS" is used even though in fact, <span class="pkg">projpred</span> resorts to SIS in these
special cases. If SIS is used, check that the reference model PSIS-LOO CV
Pareto-\(\hat{k}\) values are good.</p>
<p>With <code>parallel = TRUE</code>, costly parts of <span class="pkg">projpred</span>'s CV can be run in
parallel. Costly parts are the fold-wise searches and performance
evaluations in case of <code>validate_search = TRUE</code>. (Note that in case of
\(K\)-fold CV, the \(K\) reference model refits are not affected by
argument <code>parallel</code>; only <span class="pkg">projpred</span>'s CV is affected.) The
parallelization is powered by the <span class="pkg">foreach</span> package. Thus, any parallel
(or sequential) backend compatible with <span class="pkg">foreach</span> can be used, e.g.,
the backends from packages <span class="pkg">doParallel</span>, <span class="pkg">doMPI</span>, or
<span class="pkg">doFuture</span>. For GLMs, this CV parallelization should work reliably, but
for other models (such as GLMMs), it may lead to excessive memory usage
which in turn may crash the R session (on Unix systems, setting an
appropriate memory limit via <code><a href="https://jeroen.r-universe.dev/unix/reference/rlimit.html" class="external-link">unix::rlimit_as()</a></code> may avoid crashing the
whole machine). However, the problem of excessive memory usage is less
pronounced for the CV parallelization than for the projection
parallelization described in <a href="projpred-package.html">projpred-package</a>. In that regard, the CV
parallelization is recommended over the projection parallelization.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Magnusson, Måns, Michael Riis Andersen, Johan Jonasson, Aki Vehtari. 2020.
"Leave-One-Out Cross-Validation for Bayesian Model Comparison in Large Data."
In <em>Proceedings of the 23rd International Conference on Artificial
Intelligence and Statistics</em>, edited by Silvia Chiappa and Roberto Calandra,
108:341–351. Proceedings of Machine Learning Research. PMLR.
<a href="https://proceedings.mlr.press/v108/magnusson20a.html" class="external-link">https://proceedings.mlr.press/v108/magnusson20a.html</a>.</p>
<p>McLatchie, Yann, Sölvi Rögnvaldsson, Frank Weber, and Aki Vehtari. 2025.
"Advances in Projection Predictive Inference." <em>Statistical Science</em>, 40
(1):128–147. <a href="https://doi.org/10.1214/24-STS949" class="external-link">doi:10.1214/24-STS949</a>
.</p>
<p>Piironen, Juho, Markus Paasiniemi, and Aki Vehtari. 2020. "Projective
Inference in High-Dimensional Problems: Prediction and Feature Selection."
<em>Electronic Journal of Statistics</em>, 14 (1):2155–2197.
<a href="https://doi.org/10.1214/20-EJS1711" class="external-link">doi:10.1214/20-EJS1711</a>
.</p>
<p>Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. "Practical Bayesian Model
Evaluation Using Leave-One-Out Cross-Validation and WAIC." <em>Statistics and
Computing</em>, 27 (5):1413–32. <a href="https://doi.org/10.1007/s11222-016-9696-4" class="external-link">doi:10.1007/s11222-016-9696-4</a>
.</p>
<p>Vehtari, Aki, Daniel Simpson, Andrew Gelman, Yuling Yao, and Jonah Gabry.
2024. "Pareto Smoothed Importance Sampling." <em>Journal of Machine Learning
Research</em>, 25 (72):1–58. <a href="https://jmlr.org/papers/v25/19-556.html" class="external-link">https://jmlr.org/papers/v25/19-556.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="varsel.html">varsel()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Data:</span></span></span>
<span class="r-in"><span><span class="va">dat_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">df_gaussian</span><span class="op">$</span><span class="va">y</span>, <span class="va">df_gaussian</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `stanreg` fit which will be used as the reference model (with small</span></span></span>
<span class="r-in"><span><span class="co"># values for `chains` and `iter`, but only for technical reasons in this</span></span></span>
<span class="r-in"><span><span class="co"># example; this is not recommended in general):</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>  QR <span class="op">=</span> <span class="cn">TRUE</span>, chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">9876</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run cv_varsel() (with L1 search and small values for `K`, `nterms_max`, and</span></span></span>
<span class="r-in"><span><span class="co"># `nclusters_pred`, but only for the sake of speed in this example; this is</span></span></span>
<span class="r-in"><span><span class="co"># not recommended in general):</span></span></span>
<span class="r-in"><span><span class="va">cvvs</span> <span class="op">&lt;-</span> <span class="fu">cv_varsel</span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"L1"</span>, cv_method <span class="op">=</span> <span class="st">"kfold"</span>, K <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                  nterms_max <span class="op">=</span> <span class="fl">3</span>, nclusters_pred <span class="op">=</span> <span class="fl">10</span>, seed <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting model 1 out of 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting model 2 out of 2</span>
<span class="r-in"><span><span class="co"># Now see, for example, `?print.vsel`, `?plot.vsel`, `?suggest_size.vsel`,</span></span></span>
<span class="r-in"><span><span class="co"># and `?ranking` for possible post-processing functions.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Osvaldo Martin, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

