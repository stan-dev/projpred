<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Latent projection predictive feature selection • projpred</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Latent projection predictive feature selection">
<meta property="og:description" content="projpred">
<meta property="og:image" content="https://mc-stan.org/projpred/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">projpred</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr" class="external-link">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior" class="external-link">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/projpred/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Latent projection predictive feature
selection</h1>
            
            <h4 data-toc-skip class="date">2023-05-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/HEAD/vignettes/latent.Rmd" class="external-link"><code>vignettes/latent.Rmd</code></a></small>
      <div class="hidden name"><code>latent.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette shows how to use the latent projection predictive
feature selection from <span class="citation">Catalina, Bürkner, and
Vehtari (<a href="#ref-catalina_latent_2021" role="doc-biblioref">2021</a>)</span> in <strong>projpred</strong>. We
recommend to read the main vignette first, as the latent-projection
vignette presented here will skip some of the details explained in the
main vignette.</p>
<div class="section level3">
<h3 id="general-idea">General idea<a class="anchor" aria-label="anchor" href="#general-idea"></a>
</h3>
<p>The response families used in GLMs <span class="citation">(<a href="#ref-mccullagh_generalized_1989" role="doc-biblioref">McCullagh
and Nelder 1989, chap. 2</a>)</span> (and in GLMMs, GAMs, and GAMMs) may
be termed <em>exponential dispersion (ED)</em> families <span class="citation">(<a href="#ref-jorgensen_exponential_1987" role="doc-biblioref">Jørgensen 1987</a>)</span><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. For a response family
that is not an ED family, the Kullback-Leibler (KL) divergence
minimization problem <span class="citation">(see <a href="#ref-piironen_projective_2020" role="doc-biblioref">Piironen,
Paasiniemi, and Vehtari 2020</a>)</span> is often not easy to solve
analytically<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. In order to bypass this issue, the latent
projection <span class="citation">(<a href="#ref-catalina_latent_2021" role="doc-biblioref">Catalina, Bürkner, and Vehtari 2021</a>)</span>
solves the KL minimization problem in the predictive space of the latent
predictors<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> instead of in the predictive space of the
original response values.</p>
<p>To this end, the latent predictor is assumed to have a Gaussian
distribution, since it (i) constitutes a combination of predictor data
and regression parameters which is often linear (in the parameters,
but—less—often also in the predictor data) or at least additive (across
the predictor terms) and (ii) has the complete real line as support.
Furthermore, the Gaussian distribution has the highest differential
entropy among all distributions with two finite moments and with the
real line as support <span class="citation">(see, e.g., <a href="#ref-cover_elements_1991" role="doc-biblioref">Cover and Thomas
1991</a>)</span>. In some cases, e.g., for the probit link, the Gaussian
distribution is even part of the original statistical model. In case of
the logit link, the Gaussian distribution with a standard deviation of
1.6 approximates the logistic distribution (with a scale parameter of
1).</p>
<p>The assumption of a Gaussian distribution for the latent predictors
makes things a lot easier because it allows us to make use of
<strong>projpred</strong>’s traditional projection.</p>
<p>As illustrated by the Poisson example below, the latent projection
can not only be used for families not supported by
<strong>projpred</strong>’s traditional projection, but it can also be
beneficial for families supported by it.</p>
</div>
<div class="section level3">
<h3 id="impl">Implementation<a class="anchor" aria-label="anchor" href="#impl"></a>
</h3>
<p>To use the latent projection in <strong>projpred</strong>, the new
argument <code>latent</code> of <code><a href="../reference/extend_family.html">extend_family()</a></code> needs to be
set to <code>TRUE</code>. Since <code><a href="../reference/extend_family.html">extend_family()</a></code> is called
by <code><a href="../reference/refmodel-init-get.html">init_refmodel()</a></code> which in turn is called by
<code><a href="../reference/refmodel-init-get.html">get_refmodel()</a></code> (more precisely, by the
<code><a href="../reference/refmodel-init-get.html">get_refmodel()</a></code> methods) which in turn is called at the
beginning of the top-level functions <code><a href="../reference/project.html">project()</a></code>,
<code><a href="../reference/varsel.html">varsel()</a></code>, and <code><a href="../reference/cv_varsel.html">cv_varsel()</a></code>, it is possible to
pass <code>latent = TRUE</code> from such a top-level function down to
<code><a href="../reference/extend_family.html">extend_family()</a></code> via the ellipsis (<code>...</code>).
However, for the latent projection, we recommend to define the reference
model object of class <code>refmodel</code> explicitly (as illustrated
in the examples below) to avoid repetitions<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p>After performing the projection (either as a stand-alone feature via
<code><a href="../reference/project.html">project()</a></code> or embedded in a variable selection via
<code><a href="../reference/varsel.html">varsel()</a></code> or <code><a href="../reference/cv_varsel.html">cv_varsel()</a></code>), the post-processing
(e.g., the calculation of the performance statistics in
<code><a href="../reference/summary.vsel.html">summary.vsel()</a></code>) can be performed on the original response
scale. For this, <code><a href="../reference/extend_family.html">extend_family()</a></code> has gained several new
arguments accepting R functions responsible for the inverse-link
transformation from latent scale to response scale
(<code>latent_ilink</code>), for the calculation of log-likelihood
values on response scale (<code>latent_ll_oscale</code>), and for
drawing from the (posterior-projection) predictive distribution on
response scale (<code>latent_ppd_oscale</code>). For some families,
these arguments have internal defaults implemented natively in
<strong>projpred</strong>. These families are listed in the main
vignette (section <a href="https://mc-stan.org/projpred/articles/projpred.html#modtypes">“Supported
types of models”</a>). For all other families, <strong>projpred</strong>
either tries to infer a reasonable function internally (in case of
<code>latent_ilink</code>) or uses a dummy function returning only
<code>NA</code>s (in case of <code>latent_ll_oscale</code> and
<code>latent_ppd_oscale</code>), unless the user supplies custom
functions to these arguments. When creating a reference model object for
a family of the latter category (i.e., lacking full response-scale
support by default), <strong>projpred</strong> will throw messages
stating whether (and which) features will be unavailable unless at least
some of these arguments are provided by the user. Again, the ellipsis
(<code>...</code>) can be used to pass these arguments from a top-level
function such as <code><a href="../reference/cv_varsel.html">cv_varsel()</a></code> down to
<code><a href="../reference/extend_family.html">extend_family()</a></code>. In the post-processing functions,
response-scale analyses can usually be deactivated by setting the new
argument <code>resp_oscale</code> to <code>FALSE</code>, with the
exception of <code><a href="../reference/predict.refmodel.html">predict.refmodel()</a></code> and
<code><a href="../reference/pred-projection.html">proj_linpred()</a></code> where the existing arguments
<code>type</code> and <code>transform</code> serve this purpose (see the
documentation).</p>
<p>Apart from the arguments mentioned above,
<code><a href="../reference/extend_family.html">extend_family()</a></code> has also gained a new argument
<code>latent_y_unqs</code> whose purpose is described in the
documentation.</p>
<p>While the latent projection is an approximate solution to the KL
divergence minimization problem in the original response space<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>, the
augmented-data projection <span class="citation">(<a href="#ref-weber_projection_2023" role="doc-biblioref">Weber and Vehtari
2023</a>)</span> gives the exact<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> solution for some non-ED families, namely
those where the response distribution has finite support. However, the
augmented-data projection comes with a higher runtime than the latent
projection. The families supported by <strong>projpred</strong>’s
augmented-data projection are also listed in the main vignette (again
section <a href="https://mc-stan.org/projpred/articles/projpred.html#modtypes">“Supported
types of models”</a>).</p>
</div>
</div>
<div class="section level2">
<h2 id="example-poisson-distribution">Example: Poisson distribution<a class="anchor" aria-label="anchor" href="#example-poisson-distribution"></a>
</h2>
<p>In this example, we will illustrate that in case of a family
supported by <strong>projpred</strong>’s traditional projection (here
the Poisson distribution), the latent projection can improve runtime and
results of the variable selection compared to
<strong>projpred</strong>’s traditional projection, at least if the L1
search is used (see argument <code>method</code> of
<code><a href="../reference/varsel.html">varsel()</a></code> and <code><a href="../reference/cv_varsel.html">cv_varsel()</a></code>).</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>First, we generate a training and a test dataset with a
Poisson-distributed response:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of observations in the training dataset (= number of observations in</span></span>
<span><span class="co"># the test dataset):</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">71</span></span>
<span><span class="co"># Data-generating function:</span></span>
<span><span class="va">sim_poiss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nobs</span> <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">N</span>, <span class="va">ncon</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">ncats</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">nnoise</span> <span class="op">=</span> <span class="fl">39</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Regression coefficients for continuous predictors:</span></span>
<span>  <span class="va">coefs_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ncon</span><span class="op">)</span></span>
<span>  <span class="co"># Continuous predictors:</span></span>
<span>  <span class="va">dat_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nobs</span> <span class="op">*</span> <span class="va">ncon</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">ncon</span><span class="op">)</span></span>
<span>  <span class="co"># Start linear predictor:</span></span>
<span>  <span class="va">linpred</span> <span class="op">&lt;-</span> <span class="fl">2.1</span> <span class="op">+</span> <span class="va">dat_sim</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coefs_con</span></span>
<span>  </span>
<span>  <span class="co"># Categorical predictor:</span></span>
<span>  <span class="va">dat_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">dat_sim</span>,</span>
<span>    xcat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html" class="external-link">gl</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">ncats</span>, k <span class="op">=</span> <span class="va">nobs</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="va">ncats</span>, length <span class="op">=</span> <span class="va">nobs</span>,</span>
<span>              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncats</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Regression coefficients for the categorical predictor:</span></span>
<span>  <span class="va">coefs_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ncats</span><span class="op">)</span></span>
<span>  <span class="co"># Continue linear predictor:</span></span>
<span>  <span class="va">linpred</span> <span class="op">&lt;-</span> <span class="va">linpred</span> <span class="op">+</span> <span class="va">coefs_cat</span><span class="op">[</span><span class="va">dat_sim</span><span class="op">$</span><span class="va">xcat</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Noise predictors:</span></span>
<span>  <span class="va">dat_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">dat_sim</span>,</span>
<span>    xn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nobs</span> <span class="op">*</span> <span class="va">nnoise</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">nnoise</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Poisson response, using the log link (i.e., exp() as inverse link):</span></span>
<span>  <span class="va">dat_sim</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">nobs</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">linpred</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Shuffle order of observations:</span></span>
<span>  <span class="va">dat_sim</span> <span class="op">&lt;-</span> <span class="va">dat_sim</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">nobs</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="co"># Drop the shuffled original row names:</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dat_sim</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dat_sim</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Generate data:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">300417</span><span class="op">)</span></span>
<span><span class="va">dat_poiss</span> <span class="op">&lt;-</span> <span class="fu">sim_poiss</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dat_poiss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_poiss</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">dat_poiss_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">dat_poiss</span>, <span class="va">N</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reference-model">Reference model<a class="anchor" aria-label="anchor" href="#reference-model"></a>
</h3>
<p>Next, we fit the reference model that we consider as the best model
in terms of predictive performance that we can construct (here, we
assume that we don’t know about the true data-generating process even
though the dataset was simulated):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/" class="external-link">rstanarm</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of regression coefficients:</span></span>
<span><span class="op">(</span> <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat_poiss_train</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code>[1] 50</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prior guess for the number of relevant (i.e., non-zero) regression</span></span>
<span><span class="co"># coefficients:</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># Prior guess for the overall magnitude of the response values, see Table 1 of</span></span>
<span><span class="co"># Piironen and Vehtari (2017, DOI: 10.1214/17-EJS1337SI):</span></span>
<span><span class="va">mu_prior</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="co"># Hyperprior scale for tau, the global shrinkage parameter:</span></span>
<span><span class="va">tau0</span> <span class="op">&lt;-</span> <span class="va">p0</span> <span class="op">/</span> <span class="op">(</span><span class="va">D</span> <span class="op">-</span> <span class="va">p0</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mu_prior</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="co"># Set this manually if desired:</span></span>
<span><span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">### Only for technical reasons in this vignette (you can omit this when running</span></span>
<span><span class="co">### the code yourself):</span></span>
<span><span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ncores</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="co">###</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="va">ncores</span><span class="op">)</span></span>
<span><span class="va">refm_fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat_poiss_train</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  collapse <span class="op">=</span> <span class="st">" + "</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">refm_fit_poiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">refm_fml</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat_poiss_train</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html" class="external-link">hs</a></span><span class="op">(</span>global_scale <span class="op">=</span> <span class="va">tau0</span>, slab_df <span class="op">=</span> <span class="fl">100</span>, slab_scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="co">### Only for the sake of speed (not recommended in general):</span></span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="co">###</span></span>
<span>  QR <span class="op">=</span> <span class="cn">TRUE</span>, refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variable-selection-using-the-latent-projection">Variable selection using the latent projection<a class="anchor" aria-label="anchor" href="#variable-selection-using-the-latent-projection"></a>
</h3>
<p>Within <strong>projpred</strong>, we define the reference model
object explicitly and set <code>latent = TRUE</code> in the
corresponding <code><a href="../reference/refmodel-init-get.html">get_refmodel()</a></code> call (see section <a href="#impl">“Implementation”</a>) so that the latent projection is used
in downstream functions. Since we have a hold-out test dataset
available, we can use <code><a href="../reference/varsel.html">varsel()</a></code> with argument
<code>d_test</code> instead of <code><a href="../reference/cv_varsel.html">cv_varsel()</a></code>. Furthermore, we
measure the runtime to be able to compare it to the traditional
projection’s later:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/projpred/">projpred</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_test_lat_poiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dat_poiss_test</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_poiss_test</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_poiss_test</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co">### Here, we are not interested in latent-scale post-processing, so we can set</span></span>
<span>  <span class="co">### element `y` to a vector of `NA`s:</span></span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_poiss_test</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co">###</span></span>
<span>  y_oscale <span class="op">=</span> <span class="va">dat_poiss_test</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="op">)</span></span>
<span><span class="va">refm_poiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/refmodel-init-get.html">get_refmodel</a></span><span class="op">(</span><span class="va">refm_fit_poiss</span>, latent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>Since `&lt;refmodel&gt;$dis` will consist of only `NA`s, downstream analyses based on this reference model object won't be able to use log predictive density (LPD) values on latent scale. Furthermore, proj_predict() won't be able to draw from the latent Gaussian distribution.</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">vs_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varsel.html">varsel</a></span><span class="op">(</span></span>
<span>  <span class="va">refm_poiss</span>,</span>
<span>  d_test <span class="op">=</span> <span class="va">d_test_lat_poiss</span>,</span>
<span>  <span class="co">### Only for the sake of speed (not recommended in general):</span></span>
<span>  nclusters_pred <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  <span class="co">###</span></span>
<span>  nterms_max <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  <span class="co">### In interactive use, we recommend not to deactivate the verbose mode:</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="co">###</span></span>
<span>  <span class="co">### For comparability with varsel() based on the traditional projection:</span></span>
<span>  seed <span class="op">=</span> <span class="fl">95930</span></span>
<span>  <span class="co">###</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">time_lat</span><span class="op">)</span></span></code></pre></div>
<pre><code>   user  system elapsed 
  0.871   0.000   0.871 </code></pre>
<p>The message telling that <code>&lt;refmodel&gt;$dis</code> consists
of only <code>NA</code>s will not concern us here because we will only
be focusing on response-scale post-processing.</p>
<p>In order to decide for a submodel size, we first inspect the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> results:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span> <span class="va">gg_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vs_lat</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>, deltas <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p><img src="latent_files/figure-html/plot_vsel_lat-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Although the submodels’ MLPDs seem to be very close to the reference
model’s MLPD from a submodel size of 6 on, a zoomed plot reveals that
there is still some discrepancy at sizes 6 to 11 and that size 12 would
be a better choice (further down below in the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
output, we will also see that on absolute scale, the discrepancy at
sizes 6 to 11 is not negligible):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_lat</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_files/figure-html/plot_vsel_lat_zoom-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Thus, we decide for a submodel size of 12:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size_decided_lat</span> <span class="op">&lt;-</span> <span class="fl">12</span></span></code></pre></div>
<p>This is also the size that <code><a href="../reference/suggest_size.html">suggest_size()</a></code> would
suggest:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/suggest_size.html">suggest_size</a></span><span class="op">(</span><span class="va">vs_lat</span>, stat <span class="op">=</span> <span class="st">"mlpd"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 12</code></pre>
<p>To obtain the results from the <code><a href="../reference/varsel.html">varsel()</a></code> run in tabular
form, we call <code><a href="../reference/summary.vsel.html">summary.vsel()</a></code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smmry_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">vs_lat</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>,</span>
<span>                     type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>, <span class="st">"diff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">smmry_lat</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>------
Response-scale family:

Family: poisson 
Link function: log 

------
Latent-scale family:

Family: gaussian 
Link function: identity 

------
Formula: .y ~ x.1 + x.2 + x.3 + x.4 + x.5 + x.6 + x.7 + x.8 + x.9 + x.10 + 
    xcat + xn.1 + xn.2 + xn.3 + xn.4 + xn.5 + xn.6 + xn.7 + xn.8 + 
    xn.9 + xn.10 + xn.11 + xn.12 + xn.13 + xn.14 + xn.15 + xn.16 + 
    xn.17 + xn.18 + xn.19 + xn.20 + xn.21 + xn.22 + xn.23 + xn.24 + 
    xn.25 + xn.26 + xn.27 + xn.28 + xn.29 + xn.30 + xn.31 + xn.32 + 
    xn.33 + xn.34 + xn.35 + xn.36 + xn.37 + xn.38 + xn.39
Observations (training set): 71
Observations (test set): 71
Projection method: latent
Search method: L1
Maximum submodel size for the search: 14
Number of projected draws in the search: 1 (from clustered projection)
Number of projected draws in the performance evaluation: 20 (from clustered projection)

Performance evaluation summary (response scale) with `deltas = FALSE` and `cumulate = FALSE`:
 size solution_terms cv_proportions_diag    mlpd   lower   upper     diff
    0           &lt;NA&gt;                  NA -6257.6 -9041.1 -3474.0 -6254.36
    1            x.4                  NA -4185.6 -6049.0 -2322.2 -4182.39
    2            x.6                  NA -1434.7 -1989.6  -879.8 -1431.46
    3           x.10                  NA  -474.7  -679.9  -269.4  -471.45
    4            x.3                  NA  -450.2  -703.2  -197.1  -446.98
    5            x.1                  NA  -161.0  -244.8   -77.2  -157.77
    6            x.2                  NA   -62.1   -90.6   -33.6   -58.89
    7            x.8                  NA  -103.8  -158.4   -49.1  -100.58
    8            x.7                  NA  -103.6  -158.5   -48.8  -100.42
    9           xcat                  NA   -19.6   -31.9    -7.2   -16.35
   10            x.5                  NA   -13.3   -19.7    -6.9   -10.09
   11           xn.6                  NA   -13.4   -19.6    -7.2   -10.19
   12            x.9                  NA    -2.9    -3.2    -2.6     0.30
   13          xn.29                  NA    -2.9    -3.2    -2.6     0.28
   14          xn.26                  NA    -2.9    -3.2    -2.6     0.28</code></pre>
<p>On absolute scale (column <code>mlpd</code>), we see that submodel
size 11 leads to an MLPD of <code>-13.4</code>, i.e., a geometric mean
predictive density (GMPD; due to the discrete response family, the
“density” values are probabilities here, so we will report the GMPD as
percentage) of <code>exp(-13.4)</code> which is ca. 2e-04 % whereas size
12 leads to a GMPD of ca. 5.5 %. This is a considerable improvement from
size 11 to size 12, so another justification for size 12. (Size 13 would
have resulted in about the same GMPD as size 12.)</p>
<p>In the predictor ranking up to the selected size of 12, we can see
that apart from the noise term <code>xn.6</code>,
<strong>projpred</strong> has correctly selected the truly relevant
predictors first and only then the noise predictors. We can see this
more clearly using the following code:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rk_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ranking.html">ranking</a></span><span class="op">(</span><span class="va">vs_lat</span><span class="op">)</span></span>
<span><span class="op">(</span> <span class="va">predictors_final_lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rk_lat</span><span class="op">[[</span><span class="st">"fulldata"</span><span class="op">]</span><span class="op">]</span>, <span class="va">size_decided_lat</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code> [1] "x.4"  "x.6"  "x.10" "x.3"  "x.1"  "x.2"  "x.8"  "x.7"  "xcat" "x.5" 
[11] "xn.6" "x.9" </code></pre>
<p>We will skip post-selection inference here (see the main vignette for
a demonstration of post-selection inference), but note that
<code><a href="../reference/pred-projection.html">proj_predict()</a></code> has gained a new argument
<code>resp_oscale</code> and that analogous response-scale functionality
is available in <code><a href="../reference/pred-projection.html">proj_linpred()</a></code> (argument
<code>transform</code>) and <code><a href="../reference/predict.refmodel.html">predict.refmodel()</a></code> (argument
<code>type</code>).</p>
</div>
<div class="section level3">
<h3 id="variable-selection-using-the-traditional-projection">Variable selection using the traditional projection<a class="anchor" aria-label="anchor" href="#variable-selection-using-the-traditional-projection"></a>
</h3>
<p>We will now look at what <strong>projpred</strong>’s traditional
projection would have given:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_test_trad_poiss</span> <span class="op">&lt;-</span> <span class="va">d_test_lat_poiss</span></span>
<span><span class="va">d_test_trad_poiss</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">d_test_trad_poiss</span><span class="op">$</span><span class="va">y_oscale</span></span>
<span><span class="va">d_test_trad_poiss</span><span class="op">$</span><span class="va">y_oscale</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">time_trad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">vs_trad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varsel.html">varsel</a></span><span class="op">(</span></span>
<span>  <span class="va">refm_fit_poiss</span>,</span>
<span>  d_test <span class="op">=</span> <span class="va">d_test_trad_poiss</span>,</span>
<span>  <span class="co">### Only for the sake of speed (not recommended in general):</span></span>
<span>  nclusters_pred <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  <span class="co">###</span></span>
<span>  nterms_max <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  <span class="co">### In interactive use, we recommend not to deactivate the verbose mode:</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="co">###</span></span>
<span>  <span class="co">### For comparability with varsel() based on the latent projection:</span></span>
<span>  seed <span class="op">=</span> <span class="fl">95930</span></span>
<span>  <span class="co">###</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">time_trad</span><span class="op">)</span></span></code></pre></div>
<pre><code>   user  system elapsed 
  1.275   0.000   1.276 </code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span> <span class="va">gg_trad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vs_trad</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>, deltas <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p><img src="latent_files/figure-html/post_vs_trad-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smmry_trad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">vs_trad</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>,</span>
<span>                      type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>, <span class="st">"diff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">smmry_trad</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>
Family: poisson 
Link function: log 

Formula: y ~ x.1 + x.2 + x.3 + x.4 + x.5 + x.6 + x.7 + x.8 + x.9 + x.10 + 
    xcat + xn.1 + xn.2 + xn.3 + xn.4 + xn.5 + xn.6 + xn.7 + xn.8 + 
    xn.9 + xn.10 + xn.11 + xn.12 + xn.13 + xn.14 + xn.15 + xn.16 + 
    xn.17 + xn.18 + xn.19 + xn.20 + xn.21 + xn.22 + xn.23 + xn.24 + 
    xn.25 + xn.26 + xn.27 + xn.28 + xn.29 + xn.30 + xn.31 + xn.32 + 
    xn.33 + xn.34 + xn.35 + xn.36 + xn.37 + xn.38 + xn.39
Observations (training set): 71
Observations (test set): 71
Projection method: traditional
Search method: L1
Maximum submodel size for the search: 14
Number of projected draws in the search: 1 (from clustered projection)
Number of projected draws in the performance evaluation: 20 (from clustered projection)

Performance evaluation summary with `deltas = FALSE` and `cumulate = FALSE`:
 size solution_terms cv_proportions_diag  mlpd lower upper  diff
    0           &lt;NA&gt;                  NA -3471 -5064 -1877 -3467
    1            x.6                  NA -2547 -3616 -1478 -2544
    2          xn.12                  NA -3562 -5229 -1894 -3558
    3           xcat                  NA -3776 -5555 -1998 -3773
    4            x.4                  NA -2438 -3568 -1307 -2435
    5           x.10                  NA  -966 -1459  -473  -963
    6            x.3                  NA  -823 -1344  -302  -820
    7          xn.11                  NA  -686 -1127  -246  -683
    8           xn.2                  NA -1333 -2114  -551 -1329
    9          xn.22                  NA -1225 -1950  -499 -1222
   10            x.2                  NA  -742 -1136  -348  -739
   11            x.1                  NA  -108  -145   -71  -105
   12          xn.23                  NA   -84  -118   -51   -81
   13          xn.16                  NA  -121  -188   -54  -118
   14            x.8                  NA   -97  -144   -51   -94</code></pre>
<p>As these results show, the traditional projection takes longer than
the latent projection, although the difference is rather small on
absolute scale (which is due to the fact that the L1 search is already
quite fast). More importantly however, the predictive performance plot
is much more unstable and the predictor ranking contains several noise
terms before truly relevant ones.</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>In conclusion, this example showed that the latent projection can be
advantageous also for families supported by <strong>projpred</strong>’s
traditional projection by improving the runtime and the stability of the
variable selection, eventually also leading to better variable selection
results.</p>
<p>An important point is that we have used the L1 search here. In case
of the latent projection, a forward search would have given only
slightly different results (in particular, a slightly smoother
predictive performance plot). However, in case of the traditional
projection, a forward search would have given markedly better results
(in particular, the predictive performance plot would have been much
smoother and all of the noise terms would have been selected after the
truly relevant ones). Thus, the conclusions made for the L1 search here
cannot be transmitted easily to the forward search.</p>
</div>
</div>
<div class="section level2">
<h2 id="negbinex">Example: Negative binomial distribution<a class="anchor" aria-label="anchor" href="#negbinex"></a>
</h2>
<p>In this example, we will illustrate the latent projection in case of
the negative binomial family (more precisely, we are using
<code><a href="https://mc-stan.org/rstanarm/reference/neg_binomial_2.html" class="external-link">rstanarm::neg_binomial_2()</a></code> here) which is a family that is
not supported by <strong>projpred</strong>’s traditional projection<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<div class="section level3">
<h3 id="data-1">Data<a class="anchor" aria-label="anchor" href="#data-1"></a>
</h3>
<p>We will re-use the data generated above in the Poisson example.</p>
</div>
<div class="section level3">
<h3 id="reference-model-1">Reference model<a class="anchor" aria-label="anchor" href="#reference-model-1"></a>
</h3>
<p>We now fit a reference model with the negative binomial distribution
as response family. For the sake of simplicity, we won’t adjust
<code>tau0</code> to this new family, but in a real-world example, such
an adjustment would be necessary. However, since Table 1 of <span class="citation">Piironen and Vehtari (<a href="#ref-piironen_sparsity_2017" role="doc-biblioref">2017</a>)</span>
doesn’t list the negative binomial distribution, this would first
require a manual derivation of the pseudo-variance <span class="math inline">\(\tilde{\sigma}^2\)</span>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refm_fit_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">refm_fml</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/neg_binomial_2.html" class="external-link">neg_binomial_2</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat_poiss_train</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html" class="external-link">hs</a></span><span class="op">(</span>global_scale <span class="op">=</span> <span class="va">tau0</span>, slab_df <span class="op">=</span> <span class="fl">100</span>, slab_scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="co">### Only for the sake of speed (not recommended in general):</span></span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="co">###</span></span>
<span>  QR <span class="op">=</span> <span class="cn">TRUE</span>, refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variable-selection-using-the-latent-projection-1">Variable selection using the latent projection<a class="anchor" aria-label="anchor" href="#variable-selection-using-the-latent-projection-1"></a>
</h3>
<p>To request the latent projection with <code>latent = TRUE</code>, we
now need to specify more arguments (<code>latent_ll_oscale</code> and
<code>latent_ppd_oscale</code>) which will be passed to
<code><a href="../reference/extend_family.html">extend_family()</a></code><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refm_prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">refm_fit_nebin</span><span class="op">)</span><span class="op">[</span>, <span class="st">"reciprocal_dispersion"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">latent_ll_oscale_nebin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ilpreds</span>, <span class="va">y_oscale</span>,</span>
<span>                                   <span class="va">wobs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y_oscale</span><span class="op">)</span><span class="op">)</span>, <span class="va">cl_ref</span>,</span>
<span>                                   <span class="va">wdraws_ref</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl_ref</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y_oscale_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">y_oscale</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ilpreds</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ilpreds</span><span class="op">)</span>,</span>
<span>                         byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">wobs_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">wobs</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ilpreds</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ilpreds</span><span class="op">)</span>,</span>
<span>                     byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">refm_prec_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cl_agg.html">cl_agg</a></span><span class="op">(</span><span class="va">refm_prec</span>, cl <span class="op">=</span> <span class="va">cl_ref</span>, wdraws <span class="op">=</span> <span class="va">wdraws_ref</span><span class="op">)</span></span>
<span>  <span class="va">ll_unw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">dnbinom</a></span><span class="op">(</span><span class="va">y_oscale_mat</span>, size <span class="op">=</span> <span class="va">refm_prec_agg</span>, mu <span class="op">=</span> <span class="va">ilpreds</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">wobs_mat</span> <span class="op">*</span> <span class="va">ll_unw</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">latent_ppd_oscale_nebin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ilpreds_resamp</span>, <span class="va">wobs</span>, <span class="va">cl_ref</span>,</span>
<span>                                    <span class="va">wdraws_ref</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cl_ref</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    <span class="va">idxs_prjdraws</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">refm_prec_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cl_agg.html">cl_agg</a></span><span class="op">(</span><span class="va">refm_prec</span>, cl <span class="op">=</span> <span class="va">cl_ref</span>, wdraws <span class="op">=</span> <span class="va">wdraws_ref</span><span class="op">)</span></span>
<span>  <span class="va">refm_prec_agg_resamp</span> <span class="op">&lt;-</span> <span class="va">refm_prec_agg</span><span class="op">[</span><span class="va">idxs_prjdraws</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ilpreds_resamp</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">refm_prec_agg_resamp</span>,</span>
<span>                 mu <span class="op">=</span> <span class="va">ilpreds_resamp</span><span class="op">)</span></span>
<span>  <span class="va">ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">ppd</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ilpreds_resamp</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ilpreds_resamp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ppd</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">refm_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/refmodel-init-get.html">get_refmodel</a></span><span class="op">(</span><span class="va">refm_fit_nebin</span>, latent <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           latent_ll_oscale <span class="op">=</span> <span class="va">latent_ll_oscale_nebin</span>,</span>
<span>                           latent_ppd_oscale <span class="op">=</span> <span class="va">latent_ppd_oscale_nebin</span><span class="op">)</span></span></code></pre></div>
<pre><code>Defining `latent_ilink` as a function which calls `family$linkinv`, but there is no guarantee that this will work for all families. If relying on `family$linkinv` is not appropriate or if this raises an error in downstream functions, supply a custom `latent_ilink` function (which is also allowed to return only `NA`s if response-scale post-processing is not needed).</code></pre>
<pre><code>Since `&lt;refmodel&gt;$dis` will consist of only `NA`s, downstream analyses based on this reference model object won't be able to use log predictive density (LPD) values on latent scale. Furthermore, proj_predict() won't be able to draw from the latent Gaussian distribution.</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vs_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varsel.html">varsel</a></span><span class="op">(</span></span>
<span>  <span class="va">refm_nebin</span>,</span>
<span>  d_test <span class="op">=</span> <span class="va">d_test_lat_poiss</span>,</span>
<span>  <span class="co">### Only for the sake of speed (not recommended in general):</span></span>
<span>  nclusters_pred <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  <span class="co">###</span></span>
<span>  nterms_max <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  <span class="co">### In interactive use, we recommend not to deactivate the verbose mode:</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="co">###</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Again, the message telling that <code>&lt;refmodel&gt;$dis</code>
consists of only <code>NA</code>s will not concern us here because we
will only be focusing on response-scale post-processing. The message
concerning <code>latent_ilink</code> can be safely ignored here (the
internal default based on <code>family$linkinv</code> works correctly in
this case).</p>
<p>Again, we first inspect the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> results to decide for
a submodel size:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span> <span class="va">gg_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vs_nebin</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>, deltas <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p><img src="latent_files/figure-html/plot_vsel_nebin-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Again, a zoomed plot is more helpful:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_nebin</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_files/figure-html/plot_vsel_nebin_zoom-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Although the submodels’ MLPDs approach the reference model’s already
from a submodel size of 9 on (taking into account the uncertainty bars),
the curve levels off only from a submodel size of 11 on. For a more
informed decision, the GMPD could be taken into account again, but for
the sake of brevity, we will simply decide for a submodel size of 11
here:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size_decided_nebin</span> <span class="op">&lt;-</span> <span class="fl">11</span></span></code></pre></div>
<p>This is not the size that <code><a href="../reference/suggest_size.html">suggest_size()</a></code> would suggest,
but as mentioned in the main vignette and in the documentation,
<code><a href="../reference/suggest_size.html">suggest_size()</a></code> provides only a quite heuristic decision (so
we stick with our manual decision here):</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/suggest_size.html">suggest_size</a></span><span class="op">(</span><span class="va">vs_nebin</span>, stat <span class="op">=</span> <span class="st">"mlpd"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 9</code></pre>
<p>Again, we call <code><a href="../reference/summary.vsel.html">summary.vsel()</a></code> to obtain the results from
the <code><a href="../reference/varsel.html">varsel()</a></code> run in tabular form:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smmry_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">vs_nebin</span>, stats <span class="op">=</span> <span class="st">"mlpd"</span>,</span>
<span>                       type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>, <span class="st">"diff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">smmry_nebin</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>------
Response-scale family:

Family: neg_binomial_2 
Link function: log 

------
Latent-scale family:

Family: gaussian 
Link function: identity 

------
Formula: .y ~ x.1 + x.2 + x.3 + x.4 + x.5 + x.6 + x.7 + x.8 + x.9 + x.10 + 
    xcat + xn.1 + xn.2 + xn.3 + xn.4 + xn.5 + xn.6 + xn.7 + xn.8 + 
    xn.9 + xn.10 + xn.11 + xn.12 + xn.13 + xn.14 + xn.15 + xn.16 + 
    xn.17 + xn.18 + xn.19 + xn.20 + xn.21 + xn.22 + xn.23 + xn.24 + 
    xn.25 + xn.26 + xn.27 + xn.28 + xn.29 + xn.30 + xn.31 + xn.32 + 
    xn.33 + xn.34 + xn.35 + xn.36 + xn.37 + xn.38 + xn.39
Observations (training set): 71
Observations (test set): 71
Projection method: latent
Search method: L1
Maximum submodel size for the search: 14
Number of projected draws in the search: 1 (from clustered projection)
Number of projected draws in the performance evaluation: 20 (from clustered projection)

Performance evaluation summary (response scale) with `deltas = FALSE` and `cumulate = FALSE`:
 size solution_terms cv_proportions_diag   mlpd  lower  upper    diff
    0           &lt;NA&gt;                  NA -439.3 -618.8 -259.7 -435.61
    1            x.4                  NA -107.8 -141.1  -74.4 -104.09
    2            x.6                  NA  -21.4  -28.2  -14.7  -17.77
    3           x.10                  NA   -8.7  -10.0   -7.5   -5.06
    4            x.3                  NA   -5.8   -6.5   -5.0   -2.08
    5            x.1                  NA   -4.6   -5.2   -4.0   -0.94
    6            x.2                  NA   -4.1   -4.5   -3.6   -0.40
    7            x.8                  NA   -3.9   -4.3   -3.5   -0.22
    8          xn.29                  NA   -3.9   -4.3   -3.5   -0.20
    9            x.5                  NA   -3.8   -4.2   -3.4   -0.12
   10            x.7                  NA   -3.7   -4.0   -3.3    0.01
   11           xcat                  NA   -3.4   -3.8   -3.1    0.25
   12            x.9                  NA   -3.4   -3.8   -3.1    0.26
   13          xn.19                  NA   -3.4   -3.8   -3.1    0.26
   14          xn.31                  NA   -3.4   -3.8   -3.1    0.26</code></pre>
<p>As we can see from the predictor ranking included in the plot and in
the summary table, our selected 11 predictor terms lack one truly
relevant predictor (<code>x.9</code>) and include one noise term
(<code>xn.29</code>). More explicitly, our selected predictor terms
are:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rk_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ranking.html">ranking</a></span><span class="op">(</span><span class="va">vs_nebin</span><span class="op">)</span></span>
<span><span class="op">(</span> <span class="va">predictors_final_nebin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rk_nebin</span><span class="op">[[</span><span class="st">"fulldata"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                 <span class="va">size_decided_nebin</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code> [1] "x.4"   "x.6"   "x.10"  "x.3"   "x.1"   "x.2"   "x.8"   "xn.29" "x.5"  
[10] "x.7"   "xcat" </code></pre>
<p>Again, we will skip post-selection inference here (see the main
vignette for a demonstration of post-selection inference).</p>
</div>
<div class="section level3">
<h3 id="conclusion-1">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-1"></a>
</h3>
<p>This example demonstrated how the latent projection can be used for
those families which are neither supported by
<strong>projpred</strong>’s traditional nor by
<strong>projpred</strong>’s augmented-data projection. (In the future,
this vignette will be extended to demonstrate how both, latent and
augmented-data projection, can be applied to those non-ED families which
are supported by both.)</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-catalina_latent_2021" class="csl-entry">
Catalina, Alejandro, Paul Bürkner, and Aki Vehtari. 2021. <span>“Latent
Space Projection Predictive Inference.”</span> <span>arXiv</span>. <a href="https://doi.org/10.48550/arXiv.2109.04702" class="external-link">https://doi.org/10.48550/arXiv.2109.04702</a>.
</div>
<div id="ref-cover_elements_1991" class="csl-entry">
Cover, Thomas M., and Joy A. Thomas. 1991. <em>Elements of Information
Theory</em>. <span>New York, NY, USA</span>: <span>John Wiley &amp;
Sons, Ltd</span>. <a href="https://doi.org/10.1002/0471200611" class="external-link">https://doi.org/10.1002/0471200611</a>.
</div>
<div id="ref-jorgensen_exponential_1987" class="csl-entry">
Jørgensen, Bent. 1987. <span>“Exponential Dispersion Models.”</span>
<em>Journal of the Royal Statistical Society. Series B
(Methodological)</em> 49 (2): 127–62.
</div>
<div id="ref-mccullagh_generalized_1989" class="csl-entry">
McCullagh, P., and J. A. Nelder. 1989. <em>Generalized Linear
Models</em>. 2nd ed. <span>London</span>: <span>Chapman &amp;
Hall</span>.
</div>
<div id="ref-piironen_projective_2020" class="csl-entry">
Piironen, Juho, Markus Paasiniemi, and Aki Vehtari. 2020.
<span>“Projective Inference in High-Dimensional Problems:
<span>Prediction</span> and Feature Selection.”</span> <em>Electronic
Journal of Statistics</em> 14 (1): 2155–97. <a href="https://doi.org/10.1214/20-EJS1711" class="external-link">https://doi.org/10.1214/20-EJS1711</a>.
</div>
<div id="ref-piironen_sparsity_2017" class="csl-entry">
Piironen, Juho, and Aki Vehtari. 2017. <span>“Sparsity Information and
Regularization in the Horseshoe and Other Shrinkage Priors.”</span>
<em>Electronic Journal of Statistics</em> 11 (2): 5018–51. <a href="https://doi.org/10.1214/17-EJS1337SI" class="external-link">https://doi.org/10.1214/17-EJS1337SI</a>.
</div>
<div id="ref-weber_projection_2023" class="csl-entry">
Weber, Frank, and Aki Vehtari. 2023. <span>“Projection Predictive
Variable Selection for Discrete Response Families with Finite
Support.”</span> <span>arXiv</span>. <a href="https://doi.org/10.48550/arXiv.2301.01660" class="external-link">https://doi.org/10.48550/arXiv.2301.01660</a>.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p><span class="citation">Jørgensen (<a href="#ref-jorgensen_exponential_1987" role="doc-biblioref">1987</a>)</span> himself only uses the term
“exponential dispersion model”, but the discussion for that article
mentions the term “ED [i.e., exponential dispersion] family”. <span class="citation">Jørgensen (<a href="#ref-jorgensen_exponential_1987" role="doc-biblioref">1987</a>)</span> also introduces the class of
<em>discrete exponential dispersion</em> families (here abbreviated by
“DED families”), see section <a href="#negbinex">“Example: Negative
binomial distribution”</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>The set of families supported by
<strong>projpred</strong>’s traditional—i.e., neither augmented-data nor
latent—projection is only a subset of the set of all ED families
(<strong>projpred</strong>’s traditional projection supports the
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code> family, the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> family, the
<code><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">brms::bernoulli()</a></code> family via
<code><a href="https://rdrr.io/pkg/brms/man/get_refmodel.brmsfit.html" class="external-link">brms::get_refmodel.brmsfit()</a></code>, and the
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> family). Thus, we cannot use the term “ED
families” equivalently to the term “families supported by
<strong>projpred</strong>’s traditional projection”, but the concept of
ED families is important here nonetheless.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The latent predictors are also known as the linear
predictors, but “latent” is a more general term than “linear”.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>If the <code>refmodel</code>-class object is not defined
explicitly but implicitly by a call to a top-level function such as
<code><a href="../reference/project.html">project()</a></code>, <code><a href="../reference/varsel.html">varsel()</a></code>, or
<code><a href="../reference/cv_varsel.html">cv_varsel()</a></code>, then <code>latent = TRUE</code> and all other
arguments related to the latent projection need to be set in
<em>each</em> call to a top-level function.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>More precisely, the latent projection <em>replaces</em>
the KL divergence minimization problem in the original response space by
a KL divergence minimization problem in the latent space and solves the
latter.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Here, “exact” means apart from approximations and
simplifications which are also undertaken for the traditional
projection.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>The negative binomial distribution belongs to the class
of <em>discrete exponential dispersion</em> families <span class="citation">(<a href="#ref-jorgensen_exponential_1987" role="doc-biblioref">Jørgensen 1987</a>)</span> (here abbreviated by
“DED families”). DED families are closely related to ED families <span class="citation">(<a href="#ref-jorgensen_exponential_1987" role="doc-biblioref">Jørgensen 1987</a>)</span>, but strictly speaking,
the class of DED families is not a subset of the class of ED families.
GitHub issue <a href="https://github.com/stan-dev/projpred/issues/361" class="external-link">#361</a> explains
why the “traditional” projection onto a DED-family submodel is currently
not implemented in <strong>projpred</strong>.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>The suffix <code>_prec</code> in <code>refm_prec</code>
stands for “precision” because here, we follow the Stan convention (see
the Stan documentation for the <code>neg_binomial_2</code> distribution,
the <code><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">brms::negbinomial()</a></code> documentation, and the <a href="https://paul-buerkner.github.io/brms/" class="external-link"><strong>brms</strong></a>
vignette “Parameterization of Response Distributions in brms”) and
prefer the term <em>precision</em> parameter for what is denoted by
<span class="math inline">\(\phi\)</span> there (confusingly, argument
<code>size</code> in <code><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">?stats::NegBinomial</a></code>—which is the same
as <span class="math inline">\(\phi\)</span> from the Stan notation—is
called the <em>dispersion</em> parameter there, although the variance is
increased by its reciprocal).<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Aki Vehtari.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
